ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 1
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"tos_rwlock.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.tos_rwlock_create,"ax",%progbits
  16              		.align	1
  17              		.global	tos_rwlock_create
  18              		.arch armv7-m
  19              		.syntax unified
  20              		.thumb
  21              		.thumb_func
  22              		.fpu softvfp
  24              	tos_rwlock_create:
  25              	.LVL0:
  26              	.LFB110:
  27              		.file 1 "..//kernel/core/tos_rwlock.c"
   1:..//kernel/core/tos_rwlock.c **** /*----------------------------------------------------------------------------
   2:..//kernel/core/tos_rwlock.c ****  * Tencent is pleased to support the open source community by making TencentOS
   3:..//kernel/core/tos_rwlock.c ****  * available.
   4:..//kernel/core/tos_rwlock.c ****  *
   5:..//kernel/core/tos_rwlock.c ****  * Copyright (C) 2019 THL A29 Limited, a Tencent company. All rights reserved.
   6:..//kernel/core/tos_rwlock.c ****  * If you have downloaded a copy of the TencentOS binary from Tencent, please
   7:..//kernel/core/tos_rwlock.c ****  * note that the TencentOS binary is licensed under the BSD 3-Clause License.
   8:..//kernel/core/tos_rwlock.c ****  *
   9:..//kernel/core/tos_rwlock.c ****  * If you have downloaded a copy of the TencentOS source code from Tencent,
  10:..//kernel/core/tos_rwlock.c ****  * please note that TencentOS source code is licensed under the BSD 3-Clause
  11:..//kernel/core/tos_rwlock.c ****  * License, except for the third-party components listed below which are
  12:..//kernel/core/tos_rwlock.c ****  * subject to different license terms. Your integration of TencentOS into your
  13:..//kernel/core/tos_rwlock.c ****  * own projects may require compliance with the BSD 3-Clause License, as well
  14:..//kernel/core/tos_rwlock.c ****  * as the other licenses applicable to the third-party components included
  15:..//kernel/core/tos_rwlock.c ****  * within TencentOS.
  16:..//kernel/core/tos_rwlock.c ****  *---------------------------------------------------------------------------*/
  17:..//kernel/core/tos_rwlock.c **** 
  18:..//kernel/core/tos_rwlock.c **** #include "tos_k.h"
  19:..//kernel/core/tos_rwlock.c **** 
  20:..//kernel/core/tos_rwlock.c **** #if (TOS_CFG_SEM_EN > 0u) && (TOS_CFG_MUTEX_EN > 0u)
  21:..//kernel/core/tos_rwlock.c **** 
  22:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_create(k_rwlock_t *rwlock)
  23:..//kernel/core/tos_rwlock.c **** {
  28              		.loc 1 23 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		.loc 1 23 1 is_stmt 0 view .LVU1
  33 0000 70B5     		push	{r4, r5, r6, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 16
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 2


  36              		.cfi_offset 4, -16
  37              		.cfi_offset 5, -12
  38              		.cfi_offset 6, -8
  39              		.cfi_offset 14, -4
  24:..//kernel/core/tos_rwlock.c ****     k_err_t err;
  40              		.loc 1 24 5 is_stmt 1 view .LVU2
  25:..//kernel/core/tos_rwlock.c **** 
  26:..//kernel/core/tos_rwlock.c ****     TOS_PTR_SANITY_CHECK(rwlock);
  41              		.loc 1 26 5 view .LVU3
  42              		.loc 1 26 5 view .LVU4
  43 0002 D8B1     		cbz	r0, .L4
  44 0004 0446     		mov	r4, r0
  27:..//kernel/core/tos_rwlock.c **** 
  28:..//kernel/core/tos_rwlock.c ****     err = tos_sem_create(&rwlock->signal, 0u);
  45              		.loc 1 28 5 view .LVU5
  46              		.loc 1 28 11 is_stmt 0 view .LVU6
  47 0006 00F12406 		add	r6, r0, #36
  48 000a 0021     		movs	r1, #0
  49 000c 3046     		mov	r0, r6
  50              	.LVL1:
  51              		.loc 1 28 11 view .LVU7
  52 000e FFF7FEFF 		bl	tos_sem_create
  53              	.LVL2:
  29:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
  54              		.loc 1 29 5 is_stmt 1 view .LVU8
  55              		.loc 1 29 8 is_stmt 0 view .LVU9
  56 0012 0546     		mov	r5, r0
  57 0014 08B1     		cbz	r0, .L6
  58              	.LVL3:
  59              	.L2:
  30:..//kernel/core/tos_rwlock.c ****         return err;
  31:..//kernel/core/tos_rwlock.c ****     }
  32:..//kernel/core/tos_rwlock.c **** 
  33:..//kernel/core/tos_rwlock.c ****     err = tos_mutex_create(&rwlock->lock);
  34:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
  35:..//kernel/core/tos_rwlock.c ****         tos_sem_destroy(&rwlock->signal);
  36:..//kernel/core/tos_rwlock.c ****         return err;
  37:..//kernel/core/tos_rwlock.c ****     }
  38:..//kernel/core/tos_rwlock.c **** 
  39:..//kernel/core/tos_rwlock.c ****     rwlock->n_readers       = (rw_cnt_t)0u;
  40:..//kernel/core/tos_rwlock.c ****     rwlock->n_writers       = (rw_cnt_t)0u;
  41:..//kernel/core/tos_rwlock.c ****     rwlock->is_writting     = K_FALSE;
  42:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_INIT(rwlock, KNL_OBJ_TYPE_RWLOCK);
  43:..//kernel/core/tos_rwlock.c **** 
  44:..//kernel/core/tos_rwlock.c ****     return K_ERR_NONE;
  45:..//kernel/core/tos_rwlock.c **** }
  60              		.loc 1 45 1 view .LVU10
  61 0016 2846     		mov	r0, r5
  62 0018 70BD     		pop	{r4, r5, r6, pc}
  63              	.LVL4:
  64              	.L6:
  33:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
  65              		.loc 1 33 5 is_stmt 1 view .LVU11
  33:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
  66              		.loc 1 33 11 is_stmt 0 view .LVU12
  67 001a 201D     		adds	r0, r4, #4
  68              	.LVL5:
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 3


  33:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
  69              		.loc 1 33 11 view .LVU13
  70 001c FFF7FEFF 		bl	tos_mutex_create
  71              	.LVL6:
  34:..//kernel/core/tos_rwlock.c ****         tos_sem_destroy(&rwlock->signal);
  72              		.loc 1 34 5 is_stmt 1 view .LVU14
  34:..//kernel/core/tos_rwlock.c ****         tos_sem_destroy(&rwlock->signal);
  73              		.loc 1 34 8 is_stmt 0 view .LVU15
  74 0020 0546     		mov	r5, r0
  75 0022 38B9     		cbnz	r0, .L7
  39:..//kernel/core/tos_rwlock.c ****     rwlock->n_writers       = (rw_cnt_t)0u;
  76              		.loc 1 39 5 is_stmt 1 view .LVU16
  39:..//kernel/core/tos_rwlock.c ****     rwlock->n_writers       = (rw_cnt_t)0u;
  77              		.loc 1 39 29 is_stmt 0 view .LVU17
  78 0024 0023     		movs	r3, #0
  79 0026 A386     		strh	r3, [r4, #52]	@ movhi
  40:..//kernel/core/tos_rwlock.c ****     rwlock->is_writting     = K_FALSE;
  80              		.loc 1 40 5 is_stmt 1 view .LVU18
  40:..//kernel/core/tos_rwlock.c ****     rwlock->is_writting     = K_FALSE;
  81              		.loc 1 40 29 is_stmt 0 view .LVU19
  82 0028 E386     		strh	r3, [r4, #54]	@ movhi
  41:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_INIT(rwlock, KNL_OBJ_TYPE_RWLOCK);
  83              		.loc 1 41 5 is_stmt 1 view .LVU20
  41:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_INIT(rwlock, KNL_OBJ_TYPE_RWLOCK);
  84              		.loc 1 41 29 is_stmt 0 view .LVU21
  85 002a A363     		str	r3, [r4, #56]
  42:..//kernel/core/tos_rwlock.c **** 
  86              		.loc 1 42 5 is_stmt 1 view .LVU22
  87              	.LVL7:
  88              	.LBB22:
  89              	.LBI22:
  90              		.file 2 "..//kernel/core/include/tos_sys.h"
   1:..//kernel/core/include/tos_sys.h **** /*----------------------------------------------------------------------------
   2:..//kernel/core/include/tos_sys.h ****  * Tencent is pleased to support the open source community by making TencentOS
   3:..//kernel/core/include/tos_sys.h ****  * available.
   4:..//kernel/core/include/tos_sys.h ****  *
   5:..//kernel/core/include/tos_sys.h ****  * Copyright (C) 2019 THL A29 Limited, a Tencent company. All rights reserved.
   6:..//kernel/core/include/tos_sys.h ****  * If you have downloaded a copy of the TencentOS binary from Tencent, please
   7:..//kernel/core/include/tos_sys.h ****  * note that the TencentOS binary is licensed under the BSD 3-Clause License.
   8:..//kernel/core/include/tos_sys.h ****  *
   9:..//kernel/core/include/tos_sys.h ****  * If you have downloaded a copy of the TencentOS source code from Tencent,
  10:..//kernel/core/include/tos_sys.h ****  * please note that TencentOS source code is licensed under the BSD 3-Clause
  11:..//kernel/core/include/tos_sys.h ****  * License, except for the third-party components listed below which are
  12:..//kernel/core/include/tos_sys.h ****  * subject to different license terms. Your integration of TencentOS into your
  13:..//kernel/core/include/tos_sys.h ****  * own projects may require compliance with the BSD 3-Clause License, as well
  14:..//kernel/core/include/tos_sys.h ****  * as the other licenses applicable to the third-party components included
  15:..//kernel/core/include/tos_sys.h ****  * within TencentOS.
  16:..//kernel/core/include/tos_sys.h ****  *---------------------------------------------------------------------------*/
  17:..//kernel/core/include/tos_sys.h **** 
  18:..//kernel/core/include/tos_sys.h **** #ifndef _TOS_SYS_H_
  19:..//kernel/core/include/tos_sys.h **** #define  _TOS_SYS_H_
  20:..//kernel/core/include/tos_sys.h **** 
  21:..//kernel/core/include/tos_sys.h **** __CDECLS_BEGIN
  22:..//kernel/core/include/tos_sys.h **** 
  23:..//kernel/core/include/tos_sys.h **** #define K_NESTING_LIMIT_IRQ             (k_nesting_t)250u
  24:..//kernel/core/include/tos_sys.h **** #define K_NESTING_LIMIT_SCHED_LOCK      (k_nesting_t)250u
  25:..//kernel/core/include/tos_sys.h **** 
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 4


  26:..//kernel/core/include/tos_sys.h **** typedef enum knl_state_en {
  27:..//kernel/core/include/tos_sys.h ****     KNL_STATE_STOPPED,
  28:..//kernel/core/include/tos_sys.h ****     KNL_STATE_RUNNING,
  29:..//kernel/core/include/tos_sys.h **** } knl_state_t;
  30:..//kernel/core/include/tos_sys.h **** 
  31:..//kernel/core/include/tos_sys.h **** // some kind of magic number, mainly for identifing whether the object is initialized, or whether u
  32:..//kernel/core/include/tos_sys.h **** typedef enum knl_obj_type_en {
  33:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_NONE                           = 0x0000,
  34:..//kernel/core/include/tos_sys.h **** 
  35:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_BINARY_HEAP                    = 0xDAD0,
  36:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_BITMAP                         = 0xDAD1,
  37:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_CHAR_FIFO                      = 0xDAD2,
  38:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_MMBLK_POOL                     = 0xDAD3,
  39:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_MSG_QUEUE                      = 0xDAD4,
  40:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_PRIORITY_QUEUE                 = 0xDAD5,
  41:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_RING_QUEUE                     = 0xDAD6,
  42:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_STOPWATCH                      = 0xDAD7,
  43:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_TASK                           = 0xDAD8,
  44:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_TIMER                          = 0xDAD9,
  45:..//kernel/core/include/tos_sys.h **** 
  46:..//kernel/core/include/tos_sys.h ****     // ipc object
  47:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_BARRIER                        = 0x0BEE,
  48:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_COMPLETION                     = 0x1BEE,
  49:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_COUNTDOWNLATCH                 = 0x2BEE,
  50:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_EVENT                          = 0x3BEE,
  51:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_MAIL_QUEUE                     = 0x4BEE,
  52:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_MESSAGE_QUEUE                  = 0x5BEE,
  53:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_MUTEX                          = 0x6BEE,
  54:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_PRIORITY_MAIL_QUEUE            = 0x7BEE,
  55:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_PRIORITY_MESSAGE_QUEUE         = 0x8BEE,
  56:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_RWLOCK                         = 0x9BEE,
  57:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_TYPE_SEMAPHORE                      = 0xABEE,
  58:..//kernel/core/include/tos_sys.h **** } knl_obj_type_t;
  59:..//kernel/core/include/tos_sys.h **** 
  60:..//kernel/core/include/tos_sys.h **** typedef enum knl_obj_alloc_type_en {
  61:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_ALLOC_TYPE_NONE,
  62:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_ALLOC_TYPE_STATIC,
  63:..//kernel/core/include/tos_sys.h ****     KNL_OBJ_ALLOC_TYPE_DYNAMIC,
  64:..//kernel/core/include/tos_sys.h **** } knl_obj_alloc_type_t;
  65:..//kernel/core/include/tos_sys.h **** 
  66:..//kernel/core/include/tos_sys.h **** typedef struct knl_object_st {
  67:..//kernel/core/include/tos_sys.h ****     knl_obj_alloc_type_t    alloc_type; /* is dynamic allocated(using tos_mmheap) or static memory?
  68:..//kernel/core/include/tos_sys.h **** #if TOS_CFG_OBJECT_VERIFY_EN > 0u
  69:..//kernel/core/include/tos_sys.h ****     knl_obj_type_t          type;
  70:..//kernel/core/include/tos_sys.h **** #endif
  71:..//kernel/core/include/tos_sys.h **** } knl_obj_t;
  72:..//kernel/core/include/tos_sys.h **** 
  73:..//kernel/core/include/tos_sys.h **** /**
  74:..//kernel/core/include/tos_sys.h ****  * @brief Initialize the kernel.
  75:..//kernel/core/include/tos_sys.h ****  * initialize the tos tiny kernel.
  76:..//kernel/core/include/tos_sys.h ****  *
  77:..//kernel/core/include/tos_sys.h ****  * @attention None
  78:..//kernel/core/include/tos_sys.h ****  *
  79:..//kernel/core/include/tos_sys.h ****  * @param   None
  80:..//kernel/core/include/tos_sys.h ****  *
  81:..//kernel/core/include/tos_sys.h ****  * @return  errcode
  82:..//kernel/core/include/tos_sys.h ****  * @retval  Non-#K_ERR_NONE               return failed.
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 5


  83:..//kernel/core/include/tos_sys.h ****  * @retval  #K_ERR_NONE                   return successfully.
  84:..//kernel/core/include/tos_sys.h ****  */
  85:..//kernel/core/include/tos_sys.h **** __API__ k_err_t tos_knl_init(void);
  86:..//kernel/core/include/tos_sys.h **** 
  87:..//kernel/core/include/tos_sys.h **** /**
  88:..//kernel/core/include/tos_sys.h ****  * @brief Start the kernel.
  89:..//kernel/core/include/tos_sys.h ****  * get the kernel start to run, which means start the multitask scheduling.
  90:..//kernel/core/include/tos_sys.h ****  *
  91:..//kernel/core/include/tos_sys.h ****  * @attention None
  92:..//kernel/core/include/tos_sys.h ****  *
  93:..//kernel/core/include/tos_sys.h ****  * @param   None
  94:..//kernel/core/include/tos_sys.h ****  *
  95:..//kernel/core/include/tos_sys.h ****  * @return  errcode
  96:..//kernel/core/include/tos_sys.h ****  * @retval  #K_ERR_KNL_RUNNING            the kernel is already running.
  97:..//kernel/core/include/tos_sys.h ****  * @retval  #K_ERR_NONE                   return successfully.
  98:..//kernel/core/include/tos_sys.h ****  */
  99:..//kernel/core/include/tos_sys.h **** __API__ k_err_t tos_knl_start(void);
 100:..//kernel/core/include/tos_sys.h **** 
 101:..//kernel/core/include/tos_sys.h **** /**
 102:..//kernel/core/include/tos_sys.h ****  * @brief Get the kernel state.
 103:..//kernel/core/include/tos_sys.h ****  * whether the kernel is running.
 104:..//kernel/core/include/tos_sys.h ****  *
 105:..//kernel/core/include/tos_sys.h ****  * @attention None
 106:..//kernel/core/include/tos_sys.h ****  *
 107:..//kernel/core/include/tos_sys.h ****  * @param   None
 108:..//kernel/core/include/tos_sys.h ****  *
 109:..//kernel/core/include/tos_sys.h ****  * @return  whether the kernel is running.
 110:..//kernel/core/include/tos_sys.h ****  * @retval  Non-0                           the kernel is running.
 111:..//kernel/core/include/tos_sys.h ****  * @retval  0                               the kernel is not running.
 112:..//kernel/core/include/tos_sys.h ****  */
 113:..//kernel/core/include/tos_sys.h **** __API__ int     tos_knl_is_running(void);
 114:..//kernel/core/include/tos_sys.h **** 
 115:..//kernel/core/include/tos_sys.h **** /**
 116:..//kernel/core/include/tos_sys.h ****  * @brief Kernel enter the interrupt.
 117:..//kernel/core/include/tos_sys.h ****  * this function should be called in the entrance of a interrupt handler.
 118:..//kernel/core/include/tos_sys.h ****  *
 119:..//kernel/core/include/tos_sys.h ****  * @attention None
 120:..//kernel/core/include/tos_sys.h ****  *
 121:..//kernel/core/include/tos_sys.h ****  * @param   None
 122:..//kernel/core/include/tos_sys.h ****  *
 123:..//kernel/core/include/tos_sys.h ****  * @return  None
 124:..//kernel/core/include/tos_sys.h ****  */
 125:..//kernel/core/include/tos_sys.h **** __API__ void    tos_knl_irq_enter(void);
 126:..//kernel/core/include/tos_sys.h **** 
 127:..//kernel/core/include/tos_sys.h **** /**
 128:..//kernel/core/include/tos_sys.h ****  * @brief Kernel exit the interrupt.
 129:..//kernel/core/include/tos_sys.h ****  * this function should be called in the exit of a interrupt handler.
 130:..//kernel/core/include/tos_sys.h ****  *
 131:..//kernel/core/include/tos_sys.h ****  * @attention None
 132:..//kernel/core/include/tos_sys.h ****  *
 133:..//kernel/core/include/tos_sys.h ****  * @param   None
 134:..//kernel/core/include/tos_sys.h ****  *
 135:..//kernel/core/include/tos_sys.h ****  * @return  None
 136:..//kernel/core/include/tos_sys.h ****  */
 137:..//kernel/core/include/tos_sys.h **** __API__ void    tos_knl_irq_leave(void);
 138:..//kernel/core/include/tos_sys.h **** 
 139:..//kernel/core/include/tos_sys.h **** /**
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 6


 140:..//kernel/core/include/tos_sys.h ****  * @brief Lock the scheduler.
 141:..//kernel/core/include/tos_sys.h ****  * prevent the kernel from performing task schedule.
 142:..//kernel/core/include/tos_sys.h ****  *
 143:..//kernel/core/include/tos_sys.h ****  * @attention None
 144:..//kernel/core/include/tos_sys.h ****  *
 145:..//kernel/core/include/tos_sys.h ****  * @param   None
 146:..//kernel/core/include/tos_sys.h ****  *
 147:..//kernel/core/include/tos_sys.h ****  * @return  errcode
 148:..//kernel/core/include/tos_sys.h ****  * @retval  K_ERR_KNL_NOT_RUNNING         the kernel is not running.
 149:..//kernel/core/include/tos_sys.h ****  * @retval  K_ERR_LOCK_NESTING_OVERFLOW   the schedule lock nesting is overflow.
 150:..//kernel/core/include/tos_sys.h ****  * @retval  K_ERR_NONE                    return successfully.
 151:..//kernel/core/include/tos_sys.h ****  */
 152:..//kernel/core/include/tos_sys.h **** __API__ k_err_t tos_knl_sched_lock(void);
 153:..//kernel/core/include/tos_sys.h **** 
 154:..//kernel/core/include/tos_sys.h **** /**
 155:..//kernel/core/include/tos_sys.h ****  * @brief Unlock the scheduler.
 156:..//kernel/core/include/tos_sys.h ****  * re-enable the task schedule.
 157:..//kernel/core/include/tos_sys.h ****  *
 158:..//kernel/core/include/tos_sys.h ****  * @attention None
 159:..//kernel/core/include/tos_sys.h ****  *
 160:..//kernel/core/include/tos_sys.h ****  * @param   None
 161:..//kernel/core/include/tos_sys.h ****  *
 162:..//kernel/core/include/tos_sys.h ****  * @return  errcode
 163:..//kernel/core/include/tos_sys.h ****  * @retval  K_ERR_KNL_NOT_RUNNING         the kernel is not running.
 164:..//kernel/core/include/tos_sys.h ****  * @retval  K_ERR_SCHED_NOT_LOCKED        the scheduler is not locked.
 165:..//kernel/core/include/tos_sys.h ****  * @retval  K_ERR_NONE                    return successfully.
 166:..//kernel/core/include/tos_sys.h ****  */
 167:..//kernel/core/include/tos_sys.h **** __API__ k_err_t tos_knl_sched_unlock(void);
 168:..//kernel/core/include/tos_sys.h **** 
 169:..//kernel/core/include/tos_sys.h **** #if TOS_CFG_TICKLESS_EN > 0u
 170:..//kernel/core/include/tos_sys.h **** __KNL__ k_tick_t knl_next_expires_get(void);
 171:..//kernel/core/include/tos_sys.h **** #endif
 172:..//kernel/core/include/tos_sys.h **** 
 173:..//kernel/core/include/tos_sys.h **** __KNL__ void    knl_sched(void);
 174:..//kernel/core/include/tos_sys.h **** __KNL__ int     knl_is_sched_locked(void);
 175:..//kernel/core/include/tos_sys.h **** __KNL__ int     knl_is_inirq(void);
 176:..//kernel/core/include/tos_sys.h **** __KNL__ int     knl_is_idle(k_task_t *task);
 177:..//kernel/core/include/tos_sys.h **** __KNL__ int     knl_is_self(k_task_t *task);
 178:..//kernel/core/include/tos_sys.h **** __KNL__ k_err_t knl_idle_init(void);
 179:..//kernel/core/include/tos_sys.h **** 
 180:..//kernel/core/include/tos_sys.h **** #if TOS_CFG_OBJECT_VERIFY_EN > 0u
 181:..//kernel/core/include/tos_sys.h **** 
 182:..//kernel/core/include/tos_sys.h **** __KNL__ __STATIC_INLINE__ int knl_object_verify(knl_obj_t *knl_obj, knl_obj_type_t type)
 183:..//kernel/core/include/tos_sys.h **** {
 184:..//kernel/core/include/tos_sys.h ****     return knl_obj->type == type;
 185:..//kernel/core/include/tos_sys.h **** }
 186:..//kernel/core/include/tos_sys.h **** 
 187:..//kernel/core/include/tos_sys.h **** __KNL__ __STATIC_INLINE__ void knl_object_init(knl_obj_t *knl_obj, knl_obj_type_t type)
  91              		.loc 2 187 32 view .LVU23
  92              	.LBB23:
 188:..//kernel/core/include/tos_sys.h **** {
 189:..//kernel/core/include/tos_sys.h ****     knl_obj->type = type;
  93              		.loc 2 189 5 view .LVU24
  94              		.loc 2 189 19 is_stmt 0 view .LVU25
  95 002c 49F6EE33 		movw	r3, #39918
  96 0030 6380     		strh	r3, [r4, #2]	@ movhi
  97              	.LVL8:
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 7


  98              		.loc 2 189 19 view .LVU26
  99              	.LBE23:
 100              	.LBE22:
  44:..//kernel/core/tos_rwlock.c **** }
 101              		.loc 1 44 5 is_stmt 1 view .LVU27
  44:..//kernel/core/tos_rwlock.c **** }
 102              		.loc 1 44 12 is_stmt 0 view .LVU28
 103 0032 F0E7     		b	.L2
 104              	.L7:
  35:..//kernel/core/tos_rwlock.c ****         return err;
 105              		.loc 1 35 9 is_stmt 1 view .LVU29
 106 0034 3046     		mov	r0, r6
 107              	.LVL9:
  35:..//kernel/core/tos_rwlock.c ****         return err;
 108              		.loc 1 35 9 is_stmt 0 view .LVU30
 109 0036 FFF7FEFF 		bl	tos_sem_destroy
 110              	.LVL10:
  36:..//kernel/core/tos_rwlock.c ****     }
 111              		.loc 1 36 9 is_stmt 1 view .LVU31
  36:..//kernel/core/tos_rwlock.c ****     }
 112              		.loc 1 36 16 is_stmt 0 view .LVU32
 113 003a ECE7     		b	.L2
 114              	.LVL11:
 115              	.L4:
  26:..//kernel/core/tos_rwlock.c **** 
 116              		.loc 1 26 5 view .LVU33
 117 003c 40F24C45 		movw	r5, #1100
 118 0040 E9E7     		b	.L2
 119              		.cfi_endproc
 120              	.LFE110:
 122              		.section	.text.tos_rwlock_destroy,"ax",%progbits
 123              		.align	1
 124              		.global	tos_rwlock_destroy
 125              		.syntax unified
 126              		.thumb
 127              		.thumb_func
 128              		.fpu softvfp
 130              	tos_rwlock_destroy:
 131              	.LVL12:
 132              	.LFB111:
  46:..//kernel/core/tos_rwlock.c **** 
  47:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_destroy(k_rwlock_t *rwlock)
  48:..//kernel/core/tos_rwlock.c **** {
 133              		.loc 1 48 1 is_stmt 1 view -0
 134              		.cfi_startproc
 135              		@ args = 0, pretend = 0, frame = 0
 136              		@ frame_needed = 0, uses_anonymous_args = 0
 137              		.loc 1 48 1 is_stmt 0 view .LVU35
 138 0000 38B5     		push	{r3, r4, r5, lr}
 139              	.LCFI1:
 140              		.cfi_def_cfa_offset 16
 141              		.cfi_offset 3, -16
 142              		.cfi_offset 4, -12
 143              		.cfi_offset 5, -8
 144              		.cfi_offset 14, -4
  49:..//kernel/core/tos_rwlock.c ****     k_err_t err0, err1;
 145              		.loc 1 49 5 is_stmt 1 view .LVU36
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 8


  50:..//kernel/core/tos_rwlock.c **** 
  51:..//kernel/core/tos_rwlock.c ****     TOS_PTR_SANITY_CHECK(rwlock);
 146              		.loc 1 51 5 view .LVU37
 147              		.loc 1 51 5 view .LVU38
 148 0002 C8B1     		cbz	r0, .L10
 149 0004 0446     		mov	r4, r0
  52:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 150              		.loc 1 52 5 view .LVU39
 151              		.loc 1 52 5 view .LVU40
 152              	.LVL13:
 153              	.LBB24:
 154              	.LBI24:
 182:..//kernel/core/include/tos_sys.h **** {
 155              		.loc 2 182 31 view .LVU41
 156              	.LBB25:
 184:..//kernel/core/include/tos_sys.h **** }
 157              		.loc 2 184 5 view .LVU42
 184:..//kernel/core/include/tos_sys.h **** }
 158              		.loc 2 184 19 is_stmt 0 view .LVU43
 159 0006 4288     		ldrh	r2, [r0, #2]
 160              	.LVL14:
 184:..//kernel/core/include/tos_sys.h **** }
 161              		.loc 2 184 19 view .LVU44
 162              	.LBE25:
 163              	.LBE24:
 164              		.loc 1 52 5 view .LVU45
 165 0008 49F6EE33 		movw	r3, #39918
 166 000c 9A42     		cmp	r2, r3
 167 000e 03D0     		beq	.L13
 168 0010 40F24D45 		movw	r5, #1101
 169              	.LVL15:
 170              	.L9:
  53:..//kernel/core/tos_rwlock.c **** 
  54:..//kernel/core/tos_rwlock.c ****     err0 = tos_sem_destroy(&rwlock->signal);
  55:..//kernel/core/tos_rwlock.c ****     err1 = tos_mutex_destroy(&rwlock->lock);
  56:..//kernel/core/tos_rwlock.c **** 
  57:..//kernel/core/tos_rwlock.c ****     rwlock->n_readers       = (rw_cnt_t)0u;
  58:..//kernel/core/tos_rwlock.c ****     rwlock->n_writers       = (rw_cnt_t)0u;
  59:..//kernel/core/tos_rwlock.c ****     rwlock->is_writting     = K_FALSE;
  60:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_DEINIT(rwlock);
  61:..//kernel/core/tos_rwlock.c **** 
  62:..//kernel/core/tos_rwlock.c ****     if (err0 != K_ERR_NONE) {
  63:..//kernel/core/tos_rwlock.c ****         return err0;
  64:..//kernel/core/tos_rwlock.c ****     }
  65:..//kernel/core/tos_rwlock.c **** 
  66:..//kernel/core/tos_rwlock.c ****     return err1;
  67:..//kernel/core/tos_rwlock.c **** }
 171              		.loc 1 67 1 view .LVU46
 172 0014 2846     		mov	r0, r5
 173 0016 38BD     		pop	{r3, r4, r5, pc}
 174              	.LVL16:
 175              	.L13:
  54:..//kernel/core/tos_rwlock.c ****     err1 = tos_mutex_destroy(&rwlock->lock);
 176              		.loc 1 54 5 is_stmt 1 view .LVU47
  54:..//kernel/core/tos_rwlock.c ****     err1 = tos_mutex_destroy(&rwlock->lock);
 177              		.loc 1 54 12 is_stmt 0 view .LVU48
 178 0018 2430     		adds	r0, r0, #36
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 9


 179              	.LVL17:
  54:..//kernel/core/tos_rwlock.c ****     err1 = tos_mutex_destroy(&rwlock->lock);
 180              		.loc 1 54 12 view .LVU49
 181 001a FFF7FEFF 		bl	tos_sem_destroy
 182              	.LVL18:
 183 001e 0546     		mov	r5, r0
 184              	.LVL19:
  55:..//kernel/core/tos_rwlock.c **** 
 185              		.loc 1 55 5 is_stmt 1 view .LVU50
  55:..//kernel/core/tos_rwlock.c **** 
 186              		.loc 1 55 12 is_stmt 0 view .LVU51
 187 0020 201D     		adds	r0, r4, #4
 188 0022 FFF7FEFF 		bl	tos_mutex_destroy
 189              	.LVL20:
  57:..//kernel/core/tos_rwlock.c ****     rwlock->n_writers       = (rw_cnt_t)0u;
 190              		.loc 1 57 5 is_stmt 1 view .LVU52
  57:..//kernel/core/tos_rwlock.c ****     rwlock->n_writers       = (rw_cnt_t)0u;
 191              		.loc 1 57 29 is_stmt 0 view .LVU53
 192 0026 0023     		movs	r3, #0
 193 0028 A386     		strh	r3, [r4, #52]	@ movhi
  58:..//kernel/core/tos_rwlock.c ****     rwlock->is_writting     = K_FALSE;
 194              		.loc 1 58 5 is_stmt 1 view .LVU54
  58:..//kernel/core/tos_rwlock.c ****     rwlock->is_writting     = K_FALSE;
 195              		.loc 1 58 29 is_stmt 0 view .LVU55
 196 002a E386     		strh	r3, [r4, #54]	@ movhi
  59:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_DEINIT(rwlock);
 197              		.loc 1 59 5 is_stmt 1 view .LVU56
  59:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_DEINIT(rwlock);
 198              		.loc 1 59 29 is_stmt 0 view .LVU57
 199 002c A363     		str	r3, [r4, #56]
  60:..//kernel/core/tos_rwlock.c **** 
 200              		.loc 1 60 5 is_stmt 1 view .LVU58
 201              	.LVL21:
 202              	.LBB26:
 203              	.LBI26:
 190:..//kernel/core/include/tos_sys.h **** }
 191:..//kernel/core/include/tos_sys.h **** 
 192:..//kernel/core/include/tos_sys.h **** __KNL__ __STATIC_INLINE__ void knl_object_deinit(knl_obj_t *knl_obj)
 204              		.loc 2 192 32 view .LVU59
 205              	.LBB27:
 193:..//kernel/core/include/tos_sys.h **** {
 194:..//kernel/core/include/tos_sys.h ****     knl_obj->type = KNL_OBJ_TYPE_NONE;
 206              		.loc 2 194 5 view .LVU60
 207              		.loc 2 194 19 is_stmt 0 view .LVU61
 208 002e 6380     		strh	r3, [r4, #2]	@ movhi
 209              	.LVL22:
 210              		.loc 2 194 19 view .LVU62
 211              	.LBE27:
 212              	.LBE26:
  62:..//kernel/core/tos_rwlock.c ****         return err0;
 213              		.loc 1 62 5 is_stmt 1 view .LVU63
  62:..//kernel/core/tos_rwlock.c ****         return err0;
 214              		.loc 1 62 8 is_stmt 0 view .LVU64
 215 0030 002D     		cmp	r5, #0
 216 0032 EFD1     		bne	.L9
  66:..//kernel/core/tos_rwlock.c **** }
 217              		.loc 1 66 12 view .LVU65
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 10


 218 0034 0546     		mov	r5, r0
 219              	.LVL23:
  66:..//kernel/core/tos_rwlock.c **** }
 220              		.loc 1 66 12 view .LVU66
 221 0036 EDE7     		b	.L9
 222              	.LVL24:
 223              	.L10:
  51:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 224              		.loc 1 51 5 view .LVU67
 225 0038 40F24C45 		movw	r5, #1100
 226 003c EAE7     		b	.L9
 227              		.cfi_endproc
 228              	.LFE111:
 230              		.section	.text.tos_rwlock_rpend_timed,"ax",%progbits
 231              		.align	1
 232              		.global	tos_rwlock_rpend_timed
 233              		.syntax unified
 234              		.thumb
 235              		.thumb_func
 236              		.fpu softvfp
 238              	tos_rwlock_rpend_timed:
 239              	.LVL25:
 240              	.LFB112:
  68:..//kernel/core/tos_rwlock.c **** 
  69:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_rpend_timed(k_rwlock_t *rwlock, k_tick_t timeout)
  70:..//kernel/core/tos_rwlock.c **** {
 241              		.loc 1 70 1 is_stmt 1 view -0
 242              		.cfi_startproc
 243              		@ args = 0, pretend = 0, frame = 16
 244              		@ frame_needed = 0, uses_anonymous_args = 0
 245              		.loc 1 70 1 is_stmt 0 view .LVU69
 246 0000 2DE9F043 		push	{r4, r5, r6, r7, r8, r9, lr}
 247              	.LCFI2:
 248              		.cfi_def_cfa_offset 28
 249              		.cfi_offset 4, -28
 250              		.cfi_offset 5, -24
 251              		.cfi_offset 6, -20
 252              		.cfi_offset 7, -16
 253              		.cfi_offset 8, -12
 254              		.cfi_offset 9, -8
 255              		.cfi_offset 14, -4
 256 0004 85B0     		sub	sp, sp, #20
 257              	.LCFI3:
 258              		.cfi_def_cfa_offset 48
  71:..//kernel/core/tos_rwlock.c ****     k_err_t err;
 259              		.loc 1 71 5 is_stmt 1 view .LVU70
  72:..//kernel/core/tos_rwlock.c ****     k_stopwatch_t stopwatch;
 260              		.loc 1 72 5 view .LVU71
  73:..//kernel/core/tos_rwlock.c **** 
  74:..//kernel/core/tos_rwlock.c ****     TOS_PTR_SANITY_CHECK(rwlock);
 261              		.loc 1 74 5 view .LVU72
 262              		.loc 1 74 5 view .LVU73
 263 0006 0028     		cmp	r0, #0
 264 0008 64D0     		beq	.L23
 265 000a 1446     		mov	r4, r2
 266 000c 1D46     		mov	r5, r3
 267 000e 0646     		mov	r6, r0
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 11


  75:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 268              		.loc 1 75 5 view .LVU74
 269              		.loc 1 75 5 view .LVU75
 270              	.LVL26:
 271              	.LBB28:
 272              	.LBI28:
 182:..//kernel/core/include/tos_sys.h **** {
 273              		.loc 2 182 31 view .LVU76
 274              	.LBB29:
 184:..//kernel/core/include/tos_sys.h **** }
 275              		.loc 2 184 5 view .LVU77
 184:..//kernel/core/include/tos_sys.h **** }
 276              		.loc 2 184 19 is_stmt 0 view .LVU78
 277 0010 4288     		ldrh	r2, [r0, #2]
 278              	.LVL27:
 184:..//kernel/core/include/tos_sys.h **** }
 279              		.loc 2 184 19 view .LVU79
 280              	.LBE29:
 281              	.LBE28:
 282              		.loc 1 75 5 view .LVU80
 283 0012 49F6EE33 		movw	r3, #39918
 284 0016 9A42     		cmp	r2, r3
 285 0018 5FD1     		bne	.L24
  76:..//kernel/core/tos_rwlock.c **** 
  77:..//kernel/core/tos_rwlock.c ****     if (timeout != TOS_TIME_FOREVER) {
 286              		.loc 1 77 5 is_stmt 1 view .LVU81
 287              		.loc 1 77 8 is_stmt 0 view .LVU82
 288 001a B5F1FF3F 		cmp	r5, #-1
 289 001e 08BF     		it	eq
 290 0020 B4F1FF3F 		cmpeq	r4, #-1
 291 0024 3BD1     		bne	.L29
 292              	.LVL28:
 293              	.L16:
  78:..//kernel/core/tos_rwlock.c ****         tos_stopwatch_create(&stopwatch);
  79:..//kernel/core/tos_rwlock.c ****         tos_stopwatch_countdown(&stopwatch, timeout);
  80:..//kernel/core/tos_rwlock.c ****     }
  81:..//kernel/core/tos_rwlock.c **** 
  82:..//kernel/core/tos_rwlock.c ****     err = tos_mutex_pend_timed(&rwlock->lock, timeout);
 294              		.loc 1 82 5 is_stmt 1 view .LVU83
 295              		.loc 1 82 11 is_stmt 0 view .LVU84
 296 0026 06F10408 		add	r8, r6, #4
 297 002a 2246     		mov	r2, r4
 298 002c 2B46     		mov	r3, r5
 299 002e 4046     		mov	r0, r8
 300 0030 FFF7FEFF 		bl	tos_mutex_pend_timed
 301              	.LVL29:
  83:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 302              		.loc 1 83 5 is_stmt 1 view .LVU85
 303              		.loc 1 83 8 is_stmt 0 view .LVU86
 304 0034 0746     		mov	r7, r0
 305 0036 0028     		cmp	r0, #0
 306 0038 51D1     		bne	.L15
  84:..//kernel/core/tos_rwlock.c ****         return err;
  85:..//kernel/core/tos_rwlock.c ****     }
  86:..//kernel/core/tos_rwlock.c **** 
  87:..//kernel/core/tos_rwlock.c ****     if (rwlock->n_readers == (rw_cnt_t)-1) {
 307              		.loc 1 87 5 is_stmt 1 view .LVU87
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 12


 308              		.loc 1 87 15 is_stmt 0 view .LVU88
 309 003a B38E     		ldrh	r3, [r6, #52]
 310              		.loc 1 87 8 view .LVU89
 311 003c 4FF6FF72 		movw	r2, #65535
 312 0040 9342     		cmp	r3, r2
 313 0042 50D0     		beq	.L25
  88:..//kernel/core/tos_rwlock.c ****         /* number of reader reachs limit */
  89:..//kernel/core/tos_rwlock.c ****         return K_ERR_RWLOCK_READERS_TO_MANY;
  90:..//kernel/core/tos_rwlock.c ****     }
  91:..//kernel/core/tos_rwlock.c **** 
  92:..//kernel/core/tos_rwlock.c ****     if (rwlock->n_writers == 0u && !rwlock->is_writting) {
 314              		.loc 1 92 5 is_stmt 1 view .LVU90
 315              		.loc 1 92 15 is_stmt 0 view .LVU91
 316 0044 B6F83690 		ldrh	r9, [r6, #54]
 317              		.loc 1 92 8 view .LVU92
 318 0048 B9F1000F 		cmp	r9, #0
 319 004c 01D1     		bne	.L17
 320              		.loc 1 92 43 discriminator 1 view .LVU93
 321 004e B26B     		ldr	r2, [r6, #56]
 322              		.loc 1 92 33 discriminator 1 view .LVU94
 323 0050 72B3     		cbz	r2, .L30
 324              	.L17:
  93:..//kernel/core/tos_rwlock.c ****         /* no writer is now holding or waiting to hold the lock */
  94:..//kernel/core/tos_rwlock.c ****         ++rwlock->n_readers;
  95:..//kernel/core/tos_rwlock.c ****         tos_mutex_post(&rwlock->lock);
  96:..//kernel/core/tos_rwlock.c ****         return K_ERR_NONE;
  97:..//kernel/core/tos_rwlock.c ****     }
  98:..//kernel/core/tos_rwlock.c **** 
  99:..//kernel/core/tos_rwlock.c ****     if (timeout != TOS_TIME_FOREVER) {
 325              		.loc 1 99 5 is_stmt 1 view .LVU95
 326              		.loc 1 99 8 is_stmt 0 view .LVU96
 327 0052 B5F1FF3F 		cmp	r5, #-1
 328 0056 08BF     		it	eq
 329 0058 B4F1FF3F 		cmpeq	r4, #-1
 330 005c 2FD1     		bne	.L31
 331              	.LVL30:
 332              	.L21:
 100:..//kernel/core/tos_rwlock.c ****         timeout = tos_stopwatch_remain(&stopwatch);
 101:..//kernel/core/tos_rwlock.c ****         if (timeout == 0u) {
 102:..//kernel/core/tos_rwlock.c ****             timeout = 1u;
 103:..//kernel/core/tos_rwlock.c ****         }
 104:..//kernel/core/tos_rwlock.c ****     }
 105:..//kernel/core/tos_rwlock.c **** 
 106:..//kernel/core/tos_rwlock.c ****     while (rwlock->n_writers > 0u || rwlock->is_writting) {
 333              		.loc 1 106 18 view .LVU97
 334 005e F38E     		ldrh	r3, [r6, #54]
 335              		.loc 1 106 11 view .LVU98
 336 0060 0BB9     		cbnz	r3, .L22
 337              		.loc 1 106 44 discriminator 1 view .LVU99
 338 0062 B36B     		ldr	r3, [r6, #56]
 339              		.loc 1 106 35 discriminator 1 view .LVU100
 340 0064 BBB1     		cbz	r3, .L19
 341              	.L22:
 107:..//kernel/core/tos_rwlock.c ****         /* util no one is writting or waiting to hold the lock */
 108:..//kernel/core/tos_rwlock.c ****         err = tos_sem_pend(&rwlock->signal, timeout);
 342              		.loc 1 108 9 is_stmt 1 view .LVU101
 343              		.loc 1 108 15 is_stmt 0 view .LVU102
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 13


 344 0066 2246     		mov	r2, r4
 345 0068 2B46     		mov	r3, r5
 346 006a 06F12400 		add	r0, r6, #36
 347 006e FFF7FEFF 		bl	tos_sem_pend
 348              	.LVL31:
 109:..//kernel/core/tos_rwlock.c ****         if (err != K_ERR_NONE) {
 349              		.loc 1 109 9 is_stmt 1 view .LVU103
 350              		.loc 1 109 12 is_stmt 0 view .LVU104
 351 0072 0746     		mov	r7, r0
 352 0074 78B9     		cbnz	r0, .L19
 110:..//kernel/core/tos_rwlock.c ****             break;
 111:..//kernel/core/tos_rwlock.c ****         }
 112:..//kernel/core/tos_rwlock.c **** 
 113:..//kernel/core/tos_rwlock.c ****         if (timeout != TOS_TIME_FOREVER) {
 353              		.loc 1 113 9 is_stmt 1 view .LVU105
 354              		.loc 1 113 12 is_stmt 0 view .LVU106
 355 0076 B5F1FF3F 		cmp	r5, #-1
 356 007a 08BF     		it	eq
 357 007c B4F1FF3F 		cmpeq	r4, #-1
 358 0080 EDD0     		beq	.L21
 114:..//kernel/core/tos_rwlock.c ****             timeout = tos_stopwatch_remain(&stopwatch);
 359              		.loc 1 114 13 is_stmt 1 view .LVU107
 360              		.loc 1 114 23 is_stmt 0 view .LVU108
 361 0082 6846     		mov	r0, sp
 362              	.LVL32:
 363              		.loc 1 114 23 view .LVU109
 364 0084 FFF7FEFF 		bl	tos_stopwatch_remain
 365              	.LVL33:
 366 0088 0446     		mov	r4, r0
 367              	.LVL34:
 368              		.loc 1 114 23 view .LVU110
 369 008a 0D46     		mov	r5, r1
 370              	.LVL35:
 115:..//kernel/core/tos_rwlock.c ****             if (timeout == 0u) {
 371              		.loc 1 115 13 is_stmt 1 view .LVU111
 372              		.loc 1 115 16 is_stmt 0 view .LVU112
 373 008c 54EA0503 		orrs	r3, r4, r5
 374 0090 E5D1     		bne	.L21
 116:..//kernel/core/tos_rwlock.c ****                 err = K_ERR_PEND_TIMEOUT;
 375              		.loc 1 116 21 view .LVU113
 376 0092 40F2B347 		movw	r7, #1203
 377              	.L19:
 378              	.LVL36:
 117:..//kernel/core/tos_rwlock.c ****                 break;
 118:..//kernel/core/tos_rwlock.c ****             }
 119:..//kernel/core/tos_rwlock.c ****         }
 120:..//kernel/core/tos_rwlock.c ****     }
 121:..//kernel/core/tos_rwlock.c **** 
 122:..//kernel/core/tos_rwlock.c ****     tos_mutex_post(&rwlock->lock);
 379              		.loc 1 122 5 is_stmt 1 view .LVU114
 380 0096 4046     		mov	r0, r8
 381 0098 FFF7FEFF 		bl	tos_mutex_post
 382              	.LVL37:
 123:..//kernel/core/tos_rwlock.c ****     return err;
 383              		.loc 1 123 5 view .LVU115
 384              		.loc 1 123 12 is_stmt 0 view .LVU116
 385 009c 1FE0     		b	.L15
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 14


 386              	.LVL38:
 387              	.L29:
  78:..//kernel/core/tos_rwlock.c ****         tos_stopwatch_countdown(&stopwatch, timeout);
 388              		.loc 1 78 9 is_stmt 1 view .LVU117
 389 009e 6846     		mov	r0, sp
 390              	.LVL39:
  78:..//kernel/core/tos_rwlock.c ****         tos_stopwatch_countdown(&stopwatch, timeout);
 391              		.loc 1 78 9 is_stmt 0 view .LVU118
 392 00a0 FFF7FEFF 		bl	tos_stopwatch_create
 393              	.LVL40:
  79:..//kernel/core/tos_rwlock.c ****     }
 394              		.loc 1 79 9 is_stmt 1 view .LVU119
 395 00a4 2246     		mov	r2, r4
 396 00a6 2B46     		mov	r3, r5
 397 00a8 6846     		mov	r0, sp
 398 00aa FFF7FEFF 		bl	tos_stopwatch_countdown
 399              	.LVL41:
 400 00ae BAE7     		b	.L16
 401              	.LVL42:
 402              	.L30:
  94:..//kernel/core/tos_rwlock.c ****         tos_mutex_post(&rwlock->lock);
 403              		.loc 1 94 9 view .LVU120
 404 00b0 0133     		adds	r3, r3, #1
 405 00b2 B386     		strh	r3, [r6, #52]	@ movhi
  95:..//kernel/core/tos_rwlock.c ****         return K_ERR_NONE;
 406              		.loc 1 95 9 view .LVU121
 407 00b4 4046     		mov	r0, r8
 408              	.LVL43:
  95:..//kernel/core/tos_rwlock.c ****         return K_ERR_NONE;
 409              		.loc 1 95 9 is_stmt 0 view .LVU122
 410 00b6 FFF7FEFF 		bl	tos_mutex_post
 411              	.LVL44:
  96:..//kernel/core/tos_rwlock.c ****     }
 412              		.loc 1 96 9 is_stmt 1 view .LVU123
  96:..//kernel/core/tos_rwlock.c ****     }
 413              		.loc 1 96 16 is_stmt 0 view .LVU124
 414 00ba 4F46     		mov	r7, r9
 415 00bc 0FE0     		b	.L15
 416              	.LVL45:
 417              	.L31:
 100:..//kernel/core/tos_rwlock.c ****         if (timeout == 0u) {
 418              		.loc 1 100 9 is_stmt 1 view .LVU125
 100:..//kernel/core/tos_rwlock.c ****         if (timeout == 0u) {
 419              		.loc 1 100 19 is_stmt 0 view .LVU126
 420 00be 6846     		mov	r0, sp
 421              	.LVL46:
 100:..//kernel/core/tos_rwlock.c ****         if (timeout == 0u) {
 422              		.loc 1 100 19 view .LVU127
 423 00c0 FFF7FEFF 		bl	tos_stopwatch_remain
 424              	.LVL47:
 425 00c4 0446     		mov	r4, r0
 426 00c6 0D46     		mov	r5, r1
 427              	.LVL48:
 101:..//kernel/core/tos_rwlock.c ****             timeout = 1u;
 428              		.loc 1 101 9 is_stmt 1 view .LVU128
 101:..//kernel/core/tos_rwlock.c ****             timeout = 1u;
 429              		.loc 1 101 12 is_stmt 0 view .LVU129
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 15


 430 00c8 54EA0503 		orrs	r3, r4, r5
 431 00cc C7D1     		bne	.L21
 102:..//kernel/core/tos_rwlock.c ****         }
 432              		.loc 1 102 21 view .LVU130
 433 00ce 0124     		movs	r4, #1
 434              	.LVL49:
 102:..//kernel/core/tos_rwlock.c ****         }
 435              		.loc 1 102 21 view .LVU131
 436 00d0 0025     		movs	r5, #0
 437 00d2 C4E7     		b	.L21
 438              	.LVL50:
 439              	.L23:
  74:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 440              		.loc 1 74 5 view .LVU132
 441 00d4 40F24C47 		movw	r7, #1100
 442 00d8 01E0     		b	.L15
 443              	.LVL51:
 444              	.L24:
  75:..//kernel/core/tos_rwlock.c **** 
 445              		.loc 1 75 5 view .LVU133
 446 00da 40F24D47 		movw	r7, #1101
 447              	.LVL52:
 448              	.L15:
 124:..//kernel/core/tos_rwlock.c **** }
 449              		.loc 1 124 1 view .LVU134
 450 00de 3846     		mov	r0, r7
 451 00e0 05B0     		add	sp, sp, #20
 452              	.LCFI4:
 453              		.cfi_remember_state
 454              		.cfi_def_cfa_offset 28
 455              		@ sp needed
 456 00e2 BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 457              	.LVL53:
 458              	.L25:
 459              	.LCFI5:
 460              		.cfi_restore_state
  89:..//kernel/core/tos_rwlock.c ****     }
 461              		.loc 1 89 16 view .LVU135
 462 00e6 4FF4C867 		mov	r7, #1600
 463 00ea F8E7     		b	.L15
 464              		.cfi_endproc
 465              	.LFE112:
 467              		.section	.text.tos_rwlock_rpend,"ax",%progbits
 468              		.align	1
 469              		.global	tos_rwlock_rpend
 470              		.syntax unified
 471              		.thumb
 472              		.thumb_func
 473              		.fpu softvfp
 475              	tos_rwlock_rpend:
 476              	.LVL54:
 477              	.LFB113:
 125:..//kernel/core/tos_rwlock.c **** 
 126:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_rpend(k_rwlock_t *rwlock)
 127:..//kernel/core/tos_rwlock.c **** {
 478              		.loc 1 127 1 is_stmt 1 view -0
 479              		.cfi_startproc
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 16


 480              		@ args = 0, pretend = 0, frame = 0
 481              		@ frame_needed = 0, uses_anonymous_args = 0
 482              		.loc 1 127 1 is_stmt 0 view .LVU137
 483 0000 08B5     		push	{r3, lr}
 484              	.LCFI6:
 485              		.cfi_def_cfa_offset 8
 486              		.cfi_offset 3, -8
 487              		.cfi_offset 14, -4
 128:..//kernel/core/tos_rwlock.c ****     return tos_rwlock_rpend_timed(rwlock, TOS_TIME_FOREVER);
 488              		.loc 1 128 5 is_stmt 1 view .LVU138
 489              		.loc 1 128 12 is_stmt 0 view .LVU139
 490 0002 4FF0FF32 		mov	r2, #-1
 491 0006 4FF0FF33 		mov	r3, #-1
 492 000a FFF7FEFF 		bl	tos_rwlock_rpend_timed
 493              	.LVL55:
 129:..//kernel/core/tos_rwlock.c **** }
 494              		.loc 1 129 1 view .LVU140
 495 000e 08BD     		pop	{r3, pc}
 496              		.cfi_endproc
 497              	.LFE113:
 499              		.section	.text.tos_rwlock_rpend_try,"ax",%progbits
 500              		.align	1
 501              		.global	tos_rwlock_rpend_try
 502              		.syntax unified
 503              		.thumb
 504              		.thumb_func
 505              		.fpu softvfp
 507              	tos_rwlock_rpend_try:
 508              	.LVL56:
 509              	.LFB114:
 130:..//kernel/core/tos_rwlock.c **** 
 131:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_rpend_try(k_rwlock_t *rwlock)
 132:..//kernel/core/tos_rwlock.c **** {
 510              		.loc 1 132 1 is_stmt 1 view -0
 511              		.cfi_startproc
 512              		@ args = 0, pretend = 0, frame = 0
 513              		@ frame_needed = 0, uses_anonymous_args = 0
 514              		.loc 1 132 1 is_stmt 0 view .LVU142
 515 0000 70B5     		push	{r4, r5, r6, lr}
 516              	.LCFI7:
 517              		.cfi_def_cfa_offset 16
 518              		.cfi_offset 4, -16
 519              		.cfi_offset 5, -12
 520              		.cfi_offset 6, -8
 521              		.cfi_offset 14, -4
 133:..//kernel/core/tos_rwlock.c ****     k_err_t err;
 522              		.loc 1 133 5 is_stmt 1 view .LVU143
 134:..//kernel/core/tos_rwlock.c **** 
 135:..//kernel/core/tos_rwlock.c ****     TOS_PTR_SANITY_CHECK(rwlock);
 523              		.loc 1 135 5 view .LVU144
 524              		.loc 1 135 5 view .LVU145
 525 0002 38B3     		cbz	r0, .L37
 526 0004 0446     		mov	r4, r0
 136:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 527              		.loc 1 136 5 view .LVU146
 528              		.loc 1 136 5 view .LVU147
 529              	.LVL57:
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 17


 530              	.LBB30:
 531              	.LBI30:
 182:..//kernel/core/include/tos_sys.h **** {
 532              		.loc 2 182 31 view .LVU148
 533              	.LBB31:
 184:..//kernel/core/include/tos_sys.h **** }
 534              		.loc 2 184 5 view .LVU149
 184:..//kernel/core/include/tos_sys.h **** }
 535              		.loc 2 184 19 is_stmt 0 view .LVU150
 536 0006 4188     		ldrh	r1, [r0, #2]
 537              	.LVL58:
 184:..//kernel/core/include/tos_sys.h **** }
 538              		.loc 2 184 19 view .LVU151
 539              	.LBE31:
 540              	.LBE30:
 541              		.loc 1 136 5 view .LVU152
 542 0008 49F6EE32 		movw	r2, #39918
 543 000c 9142     		cmp	r1, r2
 544 000e 03D0     		beq	.L41
 545 0010 40F24D45 		movw	r5, #1101
 546              	.LVL59:
 547              	.L35:
 137:..//kernel/core/tos_rwlock.c **** 
 138:..//kernel/core/tos_rwlock.c ****     err = tos_mutex_pend_timed(&rwlock->lock, TOS_TIME_NOWAIT);
 139:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 140:..//kernel/core/tos_rwlock.c ****         return err;
 141:..//kernel/core/tos_rwlock.c ****     }
 142:..//kernel/core/tos_rwlock.c **** 
 143:..//kernel/core/tos_rwlock.c ****     if (rwlock->n_readers == (rw_cnt_t)-1) {
 144:..//kernel/core/tos_rwlock.c ****         /* number of reader reachs limit */
 145:..//kernel/core/tos_rwlock.c ****         return K_ERR_RWLOCK_READERS_TO_MANY;
 146:..//kernel/core/tos_rwlock.c ****     }
 147:..//kernel/core/tos_rwlock.c **** 
 148:..//kernel/core/tos_rwlock.c ****     if (rwlock->n_writers == 0u && !rwlock->is_writting) {
 149:..//kernel/core/tos_rwlock.c ****         /* no writer is holding or waiting to hold the lock */
 150:..//kernel/core/tos_rwlock.c ****         ++rwlock->n_readers;
 151:..//kernel/core/tos_rwlock.c ****         tos_mutex_post(&rwlock->lock);
 152:..//kernel/core/tos_rwlock.c ****         return K_ERR_NONE;
 153:..//kernel/core/tos_rwlock.c ****     }
 154:..//kernel/core/tos_rwlock.c **** 
 155:..//kernel/core/tos_rwlock.c ****     /* the rwlock is held by other writters */
 156:..//kernel/core/tos_rwlock.c ****     tos_mutex_post(&rwlock->lock);
 157:..//kernel/core/tos_rwlock.c ****     return K_ERR_RWLOCK_IS_WRITTING;
 158:..//kernel/core/tos_rwlock.c **** }
 548              		.loc 1 158 1 view .LVU153
 549 0014 2846     		mov	r0, r5
 550 0016 70BD     		pop	{r4, r5, r6, pc}
 551              	.LVL60:
 552              	.L41:
 138:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 553              		.loc 1 138 5 is_stmt 1 view .LVU154
 138:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 554              		.loc 1 138 11 is_stmt 0 view .LVU155
 555 0018 061D     		adds	r6, r0, #4
 556 001a 0022     		movs	r2, #0
 557 001c 0023     		movs	r3, #0
 558 001e 3046     		mov	r0, r6
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 18


 559              	.LVL61:
 138:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 560              		.loc 1 138 11 view .LVU156
 561 0020 FFF7FEFF 		bl	tos_mutex_pend_timed
 562              	.LVL62:
 139:..//kernel/core/tos_rwlock.c ****         return err;
 563              		.loc 1 139 5 is_stmt 1 view .LVU157
 139:..//kernel/core/tos_rwlock.c ****         return err;
 564              		.loc 1 139 8 is_stmt 0 view .LVU158
 565 0024 0546     		mov	r5, r0
 566 0026 0028     		cmp	r0, #0
 567 0028 F4D1     		bne	.L35
 143:..//kernel/core/tos_rwlock.c ****         /* number of reader reachs limit */
 568              		.loc 1 143 5 is_stmt 1 view .LVU159
 143:..//kernel/core/tos_rwlock.c ****         /* number of reader reachs limit */
 569              		.loc 1 143 15 is_stmt 0 view .LVU160
 570 002a A38E     		ldrh	r3, [r4, #52]
 143:..//kernel/core/tos_rwlock.c ****         /* number of reader reachs limit */
 571              		.loc 1 143 8 view .LVU161
 572 002c 4FF6FF72 		movw	r2, #65535
 573 0030 9342     		cmp	r3, r2
 574 0032 12D0     		beq	.L39
 148:..//kernel/core/tos_rwlock.c ****         /* no writer is holding or waiting to hold the lock */
 575              		.loc 1 148 5 is_stmt 1 view .LVU162
 148:..//kernel/core/tos_rwlock.c ****         /* no writer is holding or waiting to hold the lock */
 576              		.loc 1 148 15 is_stmt 0 view .LVU163
 577 0034 E58E     		ldrh	r5, [r4, #54]
 148:..//kernel/core/tos_rwlock.c ****         /* no writer is holding or waiting to hold the lock */
 578              		.loc 1 148 8 view .LVU164
 579 0036 0DB9     		cbnz	r5, .L36
 148:..//kernel/core/tos_rwlock.c ****         /* no writer is holding or waiting to hold the lock */
 580              		.loc 1 148 43 discriminator 1 view .LVU165
 581 0038 A26B     		ldr	r2, [r4, #56]
 148:..//kernel/core/tos_rwlock.c ****         /* no writer is holding or waiting to hold the lock */
 582              		.loc 1 148 33 discriminator 1 view .LVU166
 583 003a 2AB1     		cbz	r2, .L42
 584              	.L36:
 156:..//kernel/core/tos_rwlock.c ****     return K_ERR_RWLOCK_IS_WRITTING;
 585              		.loc 1 156 5 is_stmt 1 view .LVU167
 586 003c 3046     		mov	r0, r6
 587              	.LVL63:
 156:..//kernel/core/tos_rwlock.c ****     return K_ERR_RWLOCK_IS_WRITTING;
 588              		.loc 1 156 5 is_stmt 0 view .LVU168
 589 003e FFF7FEFF 		bl	tos_mutex_post
 590              	.LVL64:
 157:..//kernel/core/tos_rwlock.c **** }
 591              		.loc 1 157 5 is_stmt 1 view .LVU169
 157:..//kernel/core/tos_rwlock.c **** }
 592              		.loc 1 157 12 is_stmt 0 view .LVU170
 593 0042 40F24265 		movw	r5, #1602
 594 0046 E5E7     		b	.L35
 595              	.LVL65:
 596              	.L42:
 150:..//kernel/core/tos_rwlock.c ****         tos_mutex_post(&rwlock->lock);
 597              		.loc 1 150 9 is_stmt 1 view .LVU171
 598 0048 0133     		adds	r3, r3, #1
 599 004a A386     		strh	r3, [r4, #52]	@ movhi
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 19


 151:..//kernel/core/tos_rwlock.c ****         return K_ERR_NONE;
 600              		.loc 1 151 9 view .LVU172
 601 004c 3046     		mov	r0, r6
 602              	.LVL66:
 151:..//kernel/core/tos_rwlock.c ****         return K_ERR_NONE;
 603              		.loc 1 151 9 is_stmt 0 view .LVU173
 604 004e FFF7FEFF 		bl	tos_mutex_post
 605              	.LVL67:
 152:..//kernel/core/tos_rwlock.c ****     }
 606              		.loc 1 152 9 is_stmt 1 view .LVU174
 152:..//kernel/core/tos_rwlock.c ****     }
 607              		.loc 1 152 16 is_stmt 0 view .LVU175
 608 0052 DFE7     		b	.L35
 609              	.LVL68:
 610              	.L37:
 135:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 611              		.loc 1 135 5 view .LVU176
 612 0054 40F24C45 		movw	r5, #1100
 613 0058 DCE7     		b	.L35
 614              	.LVL69:
 615              	.L39:
 145:..//kernel/core/tos_rwlock.c ****     }
 616              		.loc 1 145 16 view .LVU177
 617 005a 4FF4C865 		mov	r5, #1600
 618 005e D9E7     		b	.L35
 619              		.cfi_endproc
 620              	.LFE114:
 622              		.section	.text.tos_rwlock_wpend_timed,"ax",%progbits
 623              		.align	1
 624              		.global	tos_rwlock_wpend_timed
 625              		.syntax unified
 626              		.thumb
 627              		.thumb_func
 628              		.fpu softvfp
 630              	tos_rwlock_wpend_timed:
 631              	.LVL70:
 632              	.LFB115:
 159:..//kernel/core/tos_rwlock.c **** 
 160:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_wpend_timed(k_rwlock_t *rwlock, k_tick_t timeout)
 161:..//kernel/core/tos_rwlock.c **** {
 633              		.loc 1 161 1 is_stmt 1 view -0
 634              		.cfi_startproc
 635              		@ args = 0, pretend = 0, frame = 16
 636              		@ frame_needed = 0, uses_anonymous_args = 0
 637              		.loc 1 161 1 is_stmt 0 view .LVU179
 638 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 639              	.LCFI8:
 640              		.cfi_def_cfa_offset 24
 641              		.cfi_offset 4, -24
 642              		.cfi_offset 5, -20
 643              		.cfi_offset 6, -16
 644              		.cfi_offset 7, -12
 645              		.cfi_offset 8, -8
 646              		.cfi_offset 14, -4
 647 0004 84B0     		sub	sp, sp, #16
 648              	.LCFI9:
 649              		.cfi_def_cfa_offset 40
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 20


 162:..//kernel/core/tos_rwlock.c ****     k_err_t err;
 650              		.loc 1 162 5 is_stmt 1 view .LVU180
 163:..//kernel/core/tos_rwlock.c ****     k_stopwatch_t stopwatch;
 651              		.loc 1 163 5 view .LVU181
 164:..//kernel/core/tos_rwlock.c **** 
 165:..//kernel/core/tos_rwlock.c ****     TOS_PTR_SANITY_CHECK(rwlock);
 652              		.loc 1 165 5 view .LVU182
 653              		.loc 1 165 5 view .LVU183
 654 0006 0028     		cmp	r0, #0
 655 0008 65D0     		beq	.L53
 656 000a 1646     		mov	r6, r2
 657 000c 1F46     		mov	r7, r3
 658 000e 0446     		mov	r4, r0
 166:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 659              		.loc 1 166 5 view .LVU184
 660              		.loc 1 166 5 view .LVU185
 661              	.LVL71:
 662              	.LBB32:
 663              	.LBI32:
 182:..//kernel/core/include/tos_sys.h **** {
 664              		.loc 2 182 31 view .LVU186
 665              	.LBB33:
 184:..//kernel/core/include/tos_sys.h **** }
 666              		.loc 2 184 5 view .LVU187
 184:..//kernel/core/include/tos_sys.h **** }
 667              		.loc 2 184 19 is_stmt 0 view .LVU188
 668 0010 4288     		ldrh	r2, [r0, #2]
 669              	.LVL72:
 184:..//kernel/core/include/tos_sys.h **** }
 670              		.loc 2 184 19 view .LVU189
 671              	.LBE33:
 672              	.LBE32:
 673              		.loc 1 166 5 view .LVU190
 674 0012 49F6EE33 		movw	r3, #39918
 675 0016 9A42     		cmp	r2, r3
 676 0018 60D1     		bne	.L54
 167:..//kernel/core/tos_rwlock.c **** 
 168:..//kernel/core/tos_rwlock.c ****     if (timeout != TOS_TIME_FOREVER) {
 677              		.loc 1 168 5 is_stmt 1 view .LVU191
 678              		.loc 1 168 8 is_stmt 0 view .LVU192
 679 001a B7F1FF3F 		cmp	r7, #-1
 680 001e 08BF     		it	eq
 681 0020 B6F1FF3F 		cmpeq	r6, #-1
 682 0024 3ED1     		bne	.L59
 683              	.LVL73:
 684              	.L45:
 169:..//kernel/core/tos_rwlock.c ****         tos_stopwatch_create(&stopwatch);
 170:..//kernel/core/tos_rwlock.c ****         tos_stopwatch_countdown(&stopwatch, timeout);
 171:..//kernel/core/tos_rwlock.c ****     }
 172:..//kernel/core/tos_rwlock.c **** 
 173:..//kernel/core/tos_rwlock.c ****     err = tos_mutex_pend_timed(&rwlock->lock, timeout);
 685              		.loc 1 173 5 is_stmt 1 view .LVU193
 686              		.loc 1 173 11 is_stmt 0 view .LVU194
 687 0026 04F10408 		add	r8, r4, #4
 688 002a 3246     		mov	r2, r6
 689 002c 3B46     		mov	r3, r7
 690 002e 4046     		mov	r0, r8
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 21


 691 0030 FFF7FEFF 		bl	tos_mutex_pend_timed
 692              	.LVL74:
 174:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 693              		.loc 1 174 5 is_stmt 1 view .LVU195
 694              		.loc 1 174 8 is_stmt 0 view .LVU196
 695 0034 0546     		mov	r5, r0
 696 0036 88BB     		cbnz	r0, .L44
 175:..//kernel/core/tos_rwlock.c ****         return err;
 176:..//kernel/core/tos_rwlock.c ****     }
 177:..//kernel/core/tos_rwlock.c **** 
 178:..//kernel/core/tos_rwlock.c ****     if (rwlock->n_writers == (rw_cnt_t)-1) {
 697              		.loc 1 178 5 is_stmt 1 view .LVU197
 698              		.loc 1 178 15 is_stmt 0 view .LVU198
 699 0038 E38E     		ldrh	r3, [r4, #54]
 700              		.loc 1 178 8 view .LVU199
 701 003a 4FF6FF72 		movw	r2, #65535
 702 003e 9342     		cmp	r3, r2
 703 0040 4FD0     		beq	.L55
 179:..//kernel/core/tos_rwlock.c ****         /* number of waitting writer reachs limit */
 180:..//kernel/core/tos_rwlock.c ****         return K_ERR_RWLOCK_WAITING_WRITERS_TO_MANY;
 181:..//kernel/core/tos_rwlock.c ****     }
 182:..//kernel/core/tos_rwlock.c **** 
 183:..//kernel/core/tos_rwlock.c ****     ++rwlock->n_writers;
 704              		.loc 1 183 5 is_stmt 1 view .LVU200
 705 0042 0133     		adds	r3, r3, #1
 706 0044 E386     		strh	r3, [r4, #54]	@ movhi
 184:..//kernel/core/tos_rwlock.c **** 
 185:..//kernel/core/tos_rwlock.c ****     if (timeout != TOS_TIME_FOREVER) {
 707              		.loc 1 185 5 view .LVU201
 708              		.loc 1 185 8 is_stmt 0 view .LVU202
 709 0046 B7F1FF3F 		cmp	r7, #-1
 710 004a 08BF     		it	eq
 711 004c B6F1FF3F 		cmpeq	r6, #-1
 712 0050 31D1     		bne	.L60
 713              	.LVL75:
 714              	.L49:
 186:..//kernel/core/tos_rwlock.c ****         timeout = tos_stopwatch_remain(&stopwatch);
 187:..//kernel/core/tos_rwlock.c ****         if (timeout == 0u) {
 188:..//kernel/core/tos_rwlock.c ****             timeout = 1u;
 189:..//kernel/core/tos_rwlock.c ****         }
 190:..//kernel/core/tos_rwlock.c ****     }
 191:..//kernel/core/tos_rwlock.c **** 
 192:..//kernel/core/tos_rwlock.c ****     while (rwlock->n_readers > 0u || rwlock->is_writting) {
 715              		.loc 1 192 18 view .LVU203
 716 0052 A38E     		ldrh	r3, [r4, #52]
 717              		.loc 1 192 11 view .LVU204
 718 0054 0BB9     		cbnz	r3, .L50
 719              		.loc 1 192 44 discriminator 1 view .LVU205
 720 0056 A36B     		ldr	r3, [r4, #56]
 721              		.loc 1 192 35 discriminator 1 view .LVU206
 722 0058 BBB1     		cbz	r3, .L47
 723              	.L50:
 193:..//kernel/core/tos_rwlock.c ****         /* until no one is writting or reading */
 194:..//kernel/core/tos_rwlock.c ****         err = tos_sem_pend(&rwlock->signal, timeout);
 724              		.loc 1 194 9 is_stmt 1 view .LVU207
 725              		.loc 1 194 15 is_stmt 0 view .LVU208
 726 005a 3246     		mov	r2, r6
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 22


 727 005c 3B46     		mov	r3, r7
 728 005e 04F12400 		add	r0, r4, #36
 729 0062 FFF7FEFF 		bl	tos_sem_pend
 730              	.LVL76:
 195:..//kernel/core/tos_rwlock.c ****         if (err != K_ERR_NONE) {
 731              		.loc 1 195 9 is_stmt 1 view .LVU209
 732              		.loc 1 195 12 is_stmt 0 view .LVU210
 733 0066 0546     		mov	r5, r0
 734 0068 78B9     		cbnz	r0, .L47
 196:..//kernel/core/tos_rwlock.c ****             break;
 197:..//kernel/core/tos_rwlock.c ****         }
 198:..//kernel/core/tos_rwlock.c **** 
 199:..//kernel/core/tos_rwlock.c ****         if (timeout != TOS_TIME_FOREVER) {
 735              		.loc 1 199 9 is_stmt 1 view .LVU211
 736              		.loc 1 199 12 is_stmt 0 view .LVU212
 737 006a B7F1FF3F 		cmp	r7, #-1
 738 006e 08BF     		it	eq
 739 0070 B6F1FF3F 		cmpeq	r6, #-1
 740 0074 EDD0     		beq	.L49
 200:..//kernel/core/tos_rwlock.c ****             timeout = tos_stopwatch_remain(&stopwatch);
 741              		.loc 1 200 13 is_stmt 1 view .LVU213
 742              		.loc 1 200 23 is_stmt 0 view .LVU214
 743 0076 6846     		mov	r0, sp
 744              	.LVL77:
 745              		.loc 1 200 23 view .LVU215
 746 0078 FFF7FEFF 		bl	tos_stopwatch_remain
 747              	.LVL78:
 748 007c 0646     		mov	r6, r0
 749              	.LVL79:
 750              		.loc 1 200 23 view .LVU216
 751 007e 0F46     		mov	r7, r1
 752              	.LVL80:
 201:..//kernel/core/tos_rwlock.c ****             if (timeout == 0u) {
 753              		.loc 1 201 13 is_stmt 1 view .LVU217
 754              		.loc 1 201 16 is_stmt 0 view .LVU218
 755 0080 56EA0703 		orrs	r3, r6, r7
 756 0084 E5D1     		bne	.L49
 202:..//kernel/core/tos_rwlock.c ****                 err = K_ERR_PEND_TIMEOUT;
 757              		.loc 1 202 21 view .LVU219
 758 0086 40F2B345 		movw	r5, #1203
 759              	.L47:
 760              	.LVL81:
 203:..//kernel/core/tos_rwlock.c ****                 break;
 204:..//kernel/core/tos_rwlock.c ****             }
 205:..//kernel/core/tos_rwlock.c ****         }
 206:..//kernel/core/tos_rwlock.c ****     }
 207:..//kernel/core/tos_rwlock.c **** 
 208:..//kernel/core/tos_rwlock.c ****     if (err == K_ERR_NONE) {
 761              		.loc 1 208 5 is_stmt 1 view .LVU220
 762              		.loc 1 208 8 is_stmt 0 view .LVU221
 763 008a FDB9     		cbnz	r5, .L51
 209:..//kernel/core/tos_rwlock.c ****         /* we hold the wlock now */
 210:..//kernel/core/tos_rwlock.c ****         rwlock->is_writting = K_TRUE;
 764              		.loc 1 210 9 is_stmt 1 view .LVU222
 765              		.loc 1 210 29 is_stmt 0 view .LVU223
 766 008c 0123     		movs	r3, #1
 767 008e A363     		str	r3, [r4, #56]
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 23


 768              	.L52:
 211:..//kernel/core/tos_rwlock.c ****     } else {
 212:..//kernel/core/tos_rwlock.c ****         tos_sem_post_all(&rwlock->signal);
 213:..//kernel/core/tos_rwlock.c ****     }
 214:..//kernel/core/tos_rwlock.c **** 
 215:..//kernel/core/tos_rwlock.c ****     --rwlock->n_writers;
 769              		.loc 1 215 5 is_stmt 1 view .LVU224
 770              		.loc 1 215 13 is_stmt 0 view .LVU225
 771 0090 E38E     		ldrh	r3, [r4, #54]
 772              		.loc 1 215 5 view .LVU226
 773 0092 013B     		subs	r3, r3, #1
 774 0094 E386     		strh	r3, [r4, #54]	@ movhi
 216:..//kernel/core/tos_rwlock.c **** 
 217:..//kernel/core/tos_rwlock.c ****     tos_mutex_post(&rwlock->lock);
 775              		.loc 1 217 5 is_stmt 1 view .LVU227
 776 0096 4046     		mov	r0, r8
 777 0098 FFF7FEFF 		bl	tos_mutex_post
 778              	.LVL82:
 218:..//kernel/core/tos_rwlock.c ****     return err;
 779              		.loc 1 218 5 view .LVU228
 780              	.L44:
 219:..//kernel/core/tos_rwlock.c **** }
 781              		.loc 1 219 1 is_stmt 0 view .LVU229
 782 009c 2846     		mov	r0, r5
 783 009e 04B0     		add	sp, sp, #16
 784              	.LCFI10:
 785              		.cfi_remember_state
 786              		.cfi_def_cfa_offset 24
 787              		@ sp needed
 788 00a0 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 789              	.LVL83:
 790              	.L59:
 791              	.LCFI11:
 792              		.cfi_restore_state
 169:..//kernel/core/tos_rwlock.c ****         tos_stopwatch_countdown(&stopwatch, timeout);
 793              		.loc 1 169 9 is_stmt 1 view .LVU230
 794 00a4 6846     		mov	r0, sp
 795              	.LVL84:
 169:..//kernel/core/tos_rwlock.c ****         tos_stopwatch_countdown(&stopwatch, timeout);
 796              		.loc 1 169 9 is_stmt 0 view .LVU231
 797 00a6 FFF7FEFF 		bl	tos_stopwatch_create
 798              	.LVL85:
 170:..//kernel/core/tos_rwlock.c ****     }
 799              		.loc 1 170 9 is_stmt 1 view .LVU232
 800 00aa 3246     		mov	r2, r6
 801 00ac 3B46     		mov	r3, r7
 802 00ae 6846     		mov	r0, sp
 803 00b0 FFF7FEFF 		bl	tos_stopwatch_countdown
 804              	.LVL86:
 805 00b4 B7E7     		b	.L45
 806              	.LVL87:
 807              	.L60:
 186:..//kernel/core/tos_rwlock.c ****         if (timeout == 0u) {
 808              		.loc 1 186 9 view .LVU233
 186:..//kernel/core/tos_rwlock.c ****         if (timeout == 0u) {
 809              		.loc 1 186 19 is_stmt 0 view .LVU234
 810 00b6 6846     		mov	r0, sp
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 24


 811              	.LVL88:
 186:..//kernel/core/tos_rwlock.c ****         if (timeout == 0u) {
 812              		.loc 1 186 19 view .LVU235
 813 00b8 FFF7FEFF 		bl	tos_stopwatch_remain
 814              	.LVL89:
 815 00bc 0646     		mov	r6, r0
 816 00be 0F46     		mov	r7, r1
 817              	.LVL90:
 187:..//kernel/core/tos_rwlock.c ****             timeout = 1u;
 818              		.loc 1 187 9 is_stmt 1 view .LVU236
 187:..//kernel/core/tos_rwlock.c ****             timeout = 1u;
 819              		.loc 1 187 12 is_stmt 0 view .LVU237
 820 00c0 56EA0703 		orrs	r3, r6, r7
 821 00c4 C5D1     		bne	.L49
 188:..//kernel/core/tos_rwlock.c ****         }
 822              		.loc 1 188 21 view .LVU238
 823 00c6 0126     		movs	r6, #1
 824              	.LVL91:
 188:..//kernel/core/tos_rwlock.c ****         }
 825              		.loc 1 188 21 view .LVU239
 826 00c8 0027     		movs	r7, #0
 827 00ca C2E7     		b	.L49
 828              	.LVL92:
 829              	.L51:
 212:..//kernel/core/tos_rwlock.c ****     }
 830              		.loc 1 212 9 is_stmt 1 view .LVU240
 831 00cc 04F12400 		add	r0, r4, #36
 832 00d0 FFF7FEFF 		bl	tos_sem_post_all
 833              	.LVL93:
 834 00d4 DCE7     		b	.L52
 835              	.LVL94:
 836              	.L53:
 165:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 837              		.loc 1 165 5 is_stmt 0 view .LVU241
 838 00d6 40F24C45 		movw	r5, #1100
 839 00da DFE7     		b	.L44
 840              	.LVL95:
 841              	.L54:
 166:..//kernel/core/tos_rwlock.c **** 
 842              		.loc 1 166 5 view .LVU242
 843 00dc 40F24D45 		movw	r5, #1101
 844 00e0 DCE7     		b	.L44
 845              	.LVL96:
 846              	.L55:
 180:..//kernel/core/tos_rwlock.c ****     }
 847              		.loc 1 180 16 view .LVU243
 848 00e2 40F24665 		movw	r5, #1606
 849 00e6 D9E7     		b	.L44
 850              		.cfi_endproc
 851              	.LFE115:
 853              		.section	.text.tos_rwlock_wpend,"ax",%progbits
 854              		.align	1
 855              		.global	tos_rwlock_wpend
 856              		.syntax unified
 857              		.thumb
 858              		.thumb_func
 859              		.fpu softvfp
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 25


 861              	tos_rwlock_wpend:
 862              	.LVL97:
 863              	.LFB116:
 220:..//kernel/core/tos_rwlock.c **** 
 221:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_wpend(k_rwlock_t *rwlock)
 222:..//kernel/core/tos_rwlock.c **** {
 864              		.loc 1 222 1 is_stmt 1 view -0
 865              		.cfi_startproc
 866              		@ args = 0, pretend = 0, frame = 0
 867              		@ frame_needed = 0, uses_anonymous_args = 0
 868              		.loc 1 222 1 is_stmt 0 view .LVU245
 869 0000 08B5     		push	{r3, lr}
 870              	.LCFI12:
 871              		.cfi_def_cfa_offset 8
 872              		.cfi_offset 3, -8
 873              		.cfi_offset 14, -4
 223:..//kernel/core/tos_rwlock.c ****     return tos_rwlock_wpend_timed(rwlock, TOS_TIME_FOREVER);
 874              		.loc 1 223 5 is_stmt 1 view .LVU246
 875              		.loc 1 223 12 is_stmt 0 view .LVU247
 876 0002 4FF0FF32 		mov	r2, #-1
 877 0006 4FF0FF33 		mov	r3, #-1
 878 000a FFF7FEFF 		bl	tos_rwlock_wpend_timed
 879              	.LVL98:
 224:..//kernel/core/tos_rwlock.c **** }
 880              		.loc 1 224 1 view .LVU248
 881 000e 08BD     		pop	{r3, pc}
 882              		.cfi_endproc
 883              	.LFE116:
 885              		.section	.text.tos_rwlock_wpend_try,"ax",%progbits
 886              		.align	1
 887              		.global	tos_rwlock_wpend_try
 888              		.syntax unified
 889              		.thumb
 890              		.thumb_func
 891              		.fpu softvfp
 893              	tos_rwlock_wpend_try:
 894              	.LVL99:
 895              	.LFB117:
 225:..//kernel/core/tos_rwlock.c **** 
 226:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_wpend_try(k_rwlock_t *rwlock)
 227:..//kernel/core/tos_rwlock.c **** {
 896              		.loc 1 227 1 is_stmt 1 view -0
 897              		.cfi_startproc
 898              		@ args = 0, pretend = 0, frame = 0
 899              		@ frame_needed = 0, uses_anonymous_args = 0
 900              		.loc 1 227 1 is_stmt 0 view .LVU250
 901 0000 70B5     		push	{r4, r5, r6, lr}
 902              	.LCFI13:
 903              		.cfi_def_cfa_offset 16
 904              		.cfi_offset 4, -16
 905              		.cfi_offset 5, -12
 906              		.cfi_offset 6, -8
 907              		.cfi_offset 14, -4
 228:..//kernel/core/tos_rwlock.c ****     k_err_t err;
 908              		.loc 1 228 5 is_stmt 1 view .LVU251
 229:..//kernel/core/tos_rwlock.c **** 
 230:..//kernel/core/tos_rwlock.c ****     TOS_PTR_SANITY_CHECK(rwlock);
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 26


 909              		.loc 1 230 5 view .LVU252
 910              		.loc 1 230 5 view .LVU253
 911 0002 10B3     		cbz	r0, .L66
 912 0004 0446     		mov	r4, r0
 231:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 913              		.loc 1 231 5 view .LVU254
 914              		.loc 1 231 5 view .LVU255
 915              	.LVL100:
 916              	.LBB34:
 917              	.LBI34:
 182:..//kernel/core/include/tos_sys.h **** {
 918              		.loc 2 182 31 view .LVU256
 919              	.LBB35:
 184:..//kernel/core/include/tos_sys.h **** }
 920              		.loc 2 184 5 view .LVU257
 184:..//kernel/core/include/tos_sys.h **** }
 921              		.loc 2 184 19 is_stmt 0 view .LVU258
 922 0006 4188     		ldrh	r1, [r0, #2]
 923              	.LVL101:
 184:..//kernel/core/include/tos_sys.h **** }
 924              		.loc 2 184 19 view .LVU259
 925              	.LBE35:
 926              	.LBE34:
 927              		.loc 1 231 5 view .LVU260
 928 0008 49F6EE32 		movw	r2, #39918
 929 000c 9142     		cmp	r1, r2
 930 000e 03D0     		beq	.L71
 931 0010 40F24D45 		movw	r5, #1101
 932              	.LVL102:
 933              	.L64:
 232:..//kernel/core/tos_rwlock.c **** 
 233:..//kernel/core/tos_rwlock.c ****     err = tos_mutex_pend_timed(&rwlock->lock, TOS_TIME_NOWAIT);
 234:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 235:..//kernel/core/tos_rwlock.c ****         return err;
 236:..//kernel/core/tos_rwlock.c ****     }
 237:..//kernel/core/tos_rwlock.c **** 
 238:..//kernel/core/tos_rwlock.c ****     if (rwlock->n_readers > 0u) {
 239:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_IS_READING;
 240:..//kernel/core/tos_rwlock.c ****     } else if (rwlock->is_writting) {
 241:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_IS_WRITTING;
 242:..//kernel/core/tos_rwlock.c ****     } else {
 243:..//kernel/core/tos_rwlock.c ****         rwlock->is_writting = K_TRUE;
 244:..//kernel/core/tos_rwlock.c ****     }
 245:..//kernel/core/tos_rwlock.c **** 
 246:..//kernel/core/tos_rwlock.c ****     tos_mutex_post(&rwlock->lock);
 247:..//kernel/core/tos_rwlock.c ****     return err;
 248:..//kernel/core/tos_rwlock.c **** }
 934              		.loc 1 248 1 view .LVU261
 935 0014 2846     		mov	r0, r5
 936 0016 70BD     		pop	{r4, r5, r6, pc}
 937              	.LVL103:
 938              	.L71:
 233:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 939              		.loc 1 233 5 is_stmt 1 view .LVU262
 233:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 940              		.loc 1 233 11 is_stmt 0 view .LVU263
 941 0018 061D     		adds	r6, r0, #4
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 27


 942 001a 0022     		movs	r2, #0
 943 001c 0023     		movs	r3, #0
 944 001e 3046     		mov	r0, r6
 945              	.LVL104:
 233:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 946              		.loc 1 233 11 view .LVU264
 947 0020 FFF7FEFF 		bl	tos_mutex_pend_timed
 948              	.LVL105:
 234:..//kernel/core/tos_rwlock.c ****         return err;
 949              		.loc 1 234 5 is_stmt 1 view .LVU265
 234:..//kernel/core/tos_rwlock.c ****         return err;
 950              		.loc 1 234 8 is_stmt 0 view .LVU266
 951 0024 0546     		mov	r5, r0
 952 0026 0028     		cmp	r0, #0
 953 0028 F4D1     		bne	.L64
 238:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_IS_READING;
 954              		.loc 1 238 5 is_stmt 1 view .LVU267
 238:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_IS_READING;
 955              		.loc 1 238 15 is_stmt 0 view .LVU268
 956 002a A38E     		ldrh	r3, [r4, #52]
 238:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_IS_READING;
 957              		.loc 1 238 8 view .LVU269
 958 002c 23B9     		cbnz	r3, .L68
 240:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_IS_WRITTING;
 959              		.loc 1 240 12 is_stmt 1 view .LVU270
 240:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_IS_WRITTING;
 960              		.loc 1 240 22 is_stmt 0 view .LVU271
 961 002e A36B     		ldr	r3, [r4, #56]
 240:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_IS_WRITTING;
 962              		.loc 1 240 15 view .LVU272
 963 0030 43B9     		cbnz	r3, .L69
 243:..//kernel/core/tos_rwlock.c ****     }
 964              		.loc 1 243 9 is_stmt 1 view .LVU273
 243:..//kernel/core/tos_rwlock.c ****     }
 965              		.loc 1 243 29 is_stmt 0 view .LVU274
 966 0032 0123     		movs	r3, #1
 967 0034 A363     		str	r3, [r4, #56]
 968 0036 01E0     		b	.L65
 969              	.L68:
 239:..//kernel/core/tos_rwlock.c ****     } else if (rwlock->is_writting) {
 970              		.loc 1 239 13 view .LVU275
 971 0038 40F24165 		movw	r5, #1601
 972              	.L65:
 973              	.LVL106:
 246:..//kernel/core/tos_rwlock.c ****     return err;
 974              		.loc 1 246 5 is_stmt 1 view .LVU276
 975 003c 3046     		mov	r0, r6
 976 003e FFF7FEFF 		bl	tos_mutex_post
 977              	.LVL107:
 247:..//kernel/core/tos_rwlock.c **** }
 978              		.loc 1 247 5 view .LVU277
 247:..//kernel/core/tos_rwlock.c **** }
 979              		.loc 1 247 12 is_stmt 0 view .LVU278
 980 0042 E7E7     		b	.L64
 981              	.LVL108:
 982              	.L69:
 241:..//kernel/core/tos_rwlock.c ****     } else {
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 28


 983              		.loc 1 241 13 view .LVU279
 984 0044 40F24265 		movw	r5, #1602
 985 0048 F8E7     		b	.L65
 986              	.LVL109:
 987              	.L66:
 230:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 988              		.loc 1 230 5 view .LVU280
 989 004a 40F24C45 		movw	r5, #1100
 990 004e E1E7     		b	.L64
 991              		.cfi_endproc
 992              	.LFE117:
 994              		.section	.text.tos_rwlock_rpost,"ax",%progbits
 995              		.align	1
 996              		.global	tos_rwlock_rpost
 997              		.syntax unified
 998              		.thumb
 999              		.thumb_func
 1000              		.fpu softvfp
 1002              	tos_rwlock_rpost:
 1003              	.LVL110:
 1004              	.LFB118:
 249:..//kernel/core/tos_rwlock.c **** 
 250:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_rpost(k_rwlock_t *rwlock)
 251:..//kernel/core/tos_rwlock.c **** {
 1005              		.loc 1 251 1 is_stmt 1 view -0
 1006              		.cfi_startproc
 1007              		@ args = 0, pretend = 0, frame = 0
 1008              		@ frame_needed = 0, uses_anonymous_args = 0
 1009              		.loc 1 251 1 is_stmt 0 view .LVU282
 1010 0000 70B5     		push	{r4, r5, r6, lr}
 1011              	.LCFI14:
 1012              		.cfi_def_cfa_offset 16
 1013              		.cfi_offset 4, -16
 1014              		.cfi_offset 5, -12
 1015              		.cfi_offset 6, -8
 1016              		.cfi_offset 14, -4
 252:..//kernel/core/tos_rwlock.c ****     k_err_t err;
 1017              		.loc 1 252 5 is_stmt 1 view .LVU283
 253:..//kernel/core/tos_rwlock.c **** 
 254:..//kernel/core/tos_rwlock.c ****     TOS_PTR_SANITY_CHECK(rwlock);
 1018              		.loc 1 254 5 view .LVU284
 1019              		.loc 1 254 5 view .LVU285
 1020 0002 10B3     		cbz	r0, .L75
 1021 0004 0446     		mov	r4, r0
 255:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 1022              		.loc 1 255 5 view .LVU286
 1023              		.loc 1 255 5 view .LVU287
 1024              	.LVL111:
 1025              	.LBB36:
 1026              	.LBI36:
 182:..//kernel/core/include/tos_sys.h **** {
 1027              		.loc 2 182 31 view .LVU288
 1028              	.LBB37:
 184:..//kernel/core/include/tos_sys.h **** }
 1029              		.loc 2 184 5 view .LVU289
 184:..//kernel/core/include/tos_sys.h **** }
 1030              		.loc 2 184 19 is_stmt 0 view .LVU290
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 29


 1031 0006 4188     		ldrh	r1, [r0, #2]
 1032              	.LVL112:
 184:..//kernel/core/include/tos_sys.h **** }
 1033              		.loc 2 184 19 view .LVU291
 1034              	.LBE37:
 1035              	.LBE36:
 1036              		.loc 1 255 5 view .LVU292
 1037 0008 49F6EE32 		movw	r2, #39918
 1038 000c 9142     		cmp	r1, r2
 1039 000e 03D0     		beq	.L79
 1040 0010 40F24D45 		movw	r5, #1101
 1041              	.LVL113:
 1042              	.L73:
 256:..//kernel/core/tos_rwlock.c **** 
 257:..//kernel/core/tos_rwlock.c ****     err = tos_mutex_pend(&rwlock->lock);
 258:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 259:..//kernel/core/tos_rwlock.c ****         return err;
 260:..//kernel/core/tos_rwlock.c ****     }
 261:..//kernel/core/tos_rwlock.c **** 
 262:..//kernel/core/tos_rwlock.c ****     if (rwlock->n_readers == 0u) {
 263:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_NOT_READING;
 264:..//kernel/core/tos_rwlock.c ****     } else {
 265:..//kernel/core/tos_rwlock.c ****         --rwlock->n_readers;
 266:..//kernel/core/tos_rwlock.c ****         if (rwlock->n_readers == 0u) {
 267:..//kernel/core/tos_rwlock.c ****             err = tos_sem_post_all(&rwlock->signal);
 268:..//kernel/core/tos_rwlock.c ****         }
 269:..//kernel/core/tos_rwlock.c ****     }
 270:..//kernel/core/tos_rwlock.c **** 
 271:..//kernel/core/tos_rwlock.c ****     tos_mutex_post(&rwlock->lock);
 272:..//kernel/core/tos_rwlock.c ****     return err;
 273:..//kernel/core/tos_rwlock.c **** }
 1043              		.loc 1 273 1 view .LVU293
 1044 0014 2846     		mov	r0, r5
 1045 0016 70BD     		pop	{r4, r5, r6, pc}
 1046              	.LVL114:
 1047              	.L79:
 257:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 1048              		.loc 1 257 5 is_stmt 1 view .LVU294
 257:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 1049              		.loc 1 257 11 is_stmt 0 view .LVU295
 1050 0018 061D     		adds	r6, r0, #4
 1051 001a 3046     		mov	r0, r6
 1052              	.LVL115:
 257:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 1053              		.loc 1 257 11 view .LVU296
 1054 001c FFF7FEFF 		bl	tos_mutex_pend
 1055              	.LVL116:
 258:..//kernel/core/tos_rwlock.c ****         return err;
 1056              		.loc 1 258 5 is_stmt 1 view .LVU297
 258:..//kernel/core/tos_rwlock.c ****         return err;
 1057              		.loc 1 258 8 is_stmt 0 view .LVU298
 1058 0020 0546     		mov	r5, r0
 1059 0022 0028     		cmp	r0, #0
 1060 0024 F6D1     		bne	.L73
 262:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_NOT_READING;
 1061              		.loc 1 262 5 is_stmt 1 view .LVU299
 262:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_NOT_READING;
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 30


 1062              		.loc 1 262 15 is_stmt 0 view .LVU300
 1063 0026 A38E     		ldrh	r3, [r4, #52]
 262:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_NOT_READING;
 1064              		.loc 1 262 8 view .LVU301
 1065 0028 4BB1     		cbz	r3, .L77
 265:..//kernel/core/tos_rwlock.c ****         if (rwlock->n_readers == 0u) {
 1066              		.loc 1 265 9 is_stmt 1 view .LVU302
 1067 002a 013B     		subs	r3, r3, #1
 1068 002c 9BB2     		uxth	r3, r3
 1069 002e A386     		strh	r3, [r4, #52]	@ movhi
 266:..//kernel/core/tos_rwlock.c ****             err = tos_sem_post_all(&rwlock->signal);
 1070              		.loc 1 266 9 view .LVU303
 266:..//kernel/core/tos_rwlock.c ****             err = tos_sem_post_all(&rwlock->signal);
 1071              		.loc 1 266 12 is_stmt 0 view .LVU304
 1072 0030 3BB9     		cbnz	r3, .L74
 267:..//kernel/core/tos_rwlock.c ****         }
 1073              		.loc 1 267 13 is_stmt 1 view .LVU305
 267:..//kernel/core/tos_rwlock.c ****         }
 1074              		.loc 1 267 19 is_stmt 0 view .LVU306
 1075 0032 04F12400 		add	r0, r4, #36
 1076              	.LVL117:
 267:..//kernel/core/tos_rwlock.c ****         }
 1077              		.loc 1 267 19 view .LVU307
 1078 0036 FFF7FEFF 		bl	tos_sem_post_all
 1079              	.LVL118:
 1080 003a 0546     		mov	r5, r0
 1081              	.LVL119:
 267:..//kernel/core/tos_rwlock.c ****         }
 1082              		.loc 1 267 19 view .LVU308
 1083 003c 01E0     		b	.L74
 1084              	.LVL120:
 1085              	.L77:
 263:..//kernel/core/tos_rwlock.c ****     } else {
 1086              		.loc 1 263 13 view .LVU309
 1087 003e 40F24365 		movw	r5, #1603
 1088              	.LVL121:
 1089              	.L74:
 271:..//kernel/core/tos_rwlock.c ****     return err;
 1090              		.loc 1 271 5 is_stmt 1 view .LVU310
 1091 0042 3046     		mov	r0, r6
 1092 0044 FFF7FEFF 		bl	tos_mutex_post
 1093              	.LVL122:
 272:..//kernel/core/tos_rwlock.c **** }
 1094              		.loc 1 272 5 view .LVU311
 272:..//kernel/core/tos_rwlock.c **** }
 1095              		.loc 1 272 12 is_stmt 0 view .LVU312
 1096 0048 E4E7     		b	.L73
 1097              	.LVL123:
 1098              	.L75:
 254:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 1099              		.loc 1 254 5 view .LVU313
 1100 004a 40F24C45 		movw	r5, #1100
 1101 004e E1E7     		b	.L73
 1102              		.cfi_endproc
 1103              	.LFE118:
 1105              		.section	.text.tos_rwlock_wpost,"ax",%progbits
 1106              		.align	1
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 31


 1107              		.global	tos_rwlock_wpost
 1108              		.syntax unified
 1109              		.thumb
 1110              		.thumb_func
 1111              		.fpu softvfp
 1113              	tos_rwlock_wpost:
 1114              	.LVL124:
 1115              	.LFB119:
 274:..//kernel/core/tos_rwlock.c **** 
 275:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_wpost(k_rwlock_t *rwlock)
 276:..//kernel/core/tos_rwlock.c **** {
 1116              		.loc 1 276 1 is_stmt 1 view -0
 1117              		.cfi_startproc
 1118              		@ args = 0, pretend = 0, frame = 0
 1119              		@ frame_needed = 0, uses_anonymous_args = 0
 1120              		.loc 1 276 1 is_stmt 0 view .LVU315
 1121 0000 70B5     		push	{r4, r5, r6, lr}
 1122              	.LCFI15:
 1123              		.cfi_def_cfa_offset 16
 1124              		.cfi_offset 4, -16
 1125              		.cfi_offset 5, -12
 1126              		.cfi_offset 6, -8
 1127              		.cfi_offset 14, -4
 277:..//kernel/core/tos_rwlock.c ****     k_err_t err;
 1128              		.loc 1 277 5 is_stmt 1 view .LVU316
 278:..//kernel/core/tos_rwlock.c **** 
 279:..//kernel/core/tos_rwlock.c ****     TOS_PTR_SANITY_CHECK(rwlock);
 1129              		.loc 1 279 5 view .LVU317
 1130              		.loc 1 279 5 view .LVU318
 1131 0002 00B3     		cbz	r0, .L83
 1132 0004 0446     		mov	r4, r0
 280:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 1133              		.loc 1 280 5 view .LVU319
 1134              		.loc 1 280 5 view .LVU320
 1135              	.LVL125:
 1136              	.LBB38:
 1137              	.LBI38:
 182:..//kernel/core/include/tos_sys.h **** {
 1138              		.loc 2 182 31 view .LVU321
 1139              	.LBB39:
 184:..//kernel/core/include/tos_sys.h **** }
 1140              		.loc 2 184 5 view .LVU322
 184:..//kernel/core/include/tos_sys.h **** }
 1141              		.loc 2 184 19 is_stmt 0 view .LVU323
 1142 0006 4188     		ldrh	r1, [r0, #2]
 1143              	.LVL126:
 184:..//kernel/core/include/tos_sys.h **** }
 1144              		.loc 2 184 19 view .LVU324
 1145              	.LBE39:
 1146              	.LBE38:
 1147              		.loc 1 280 5 view .LVU325
 1148 0008 49F6EE32 		movw	r2, #39918
 1149 000c 9142     		cmp	r1, r2
 1150 000e 03D0     		beq	.L87
 1151 0010 40F24D45 		movw	r5, #1101
 1152              	.LVL127:
 1153              	.L81:
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 32


 281:..//kernel/core/tos_rwlock.c **** 
 282:..//kernel/core/tos_rwlock.c ****     err = tos_mutex_pend(&rwlock->lock);
 283:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 284:..//kernel/core/tos_rwlock.c ****         return err;
 285:..//kernel/core/tos_rwlock.c ****     }
 286:..//kernel/core/tos_rwlock.c **** 
 287:..//kernel/core/tos_rwlock.c ****     if (!rwlock->is_writting) {
 288:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_NOT_WRITTING;
 289:..//kernel/core/tos_rwlock.c ****     } else {
 290:..//kernel/core/tos_rwlock.c ****         rwlock->is_writting = K_FALSE;
 291:..//kernel/core/tos_rwlock.c ****         err = tos_sem_post_all(&rwlock->signal);
 292:..//kernel/core/tos_rwlock.c ****     }
 293:..//kernel/core/tos_rwlock.c **** 
 294:..//kernel/core/tos_rwlock.c ****     tos_mutex_post(&rwlock->lock);
 295:..//kernel/core/tos_rwlock.c ****     return err;
 296:..//kernel/core/tos_rwlock.c **** }
 1154              		.loc 1 296 1 view .LVU326
 1155 0014 2846     		mov	r0, r5
 1156 0016 70BD     		pop	{r4, r5, r6, pc}
 1157              	.LVL128:
 1158              	.L87:
 282:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 1159              		.loc 1 282 5 is_stmt 1 view .LVU327
 282:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 1160              		.loc 1 282 11 is_stmt 0 view .LVU328
 1161 0018 061D     		adds	r6, r0, #4
 1162 001a 3046     		mov	r0, r6
 1163              	.LVL129:
 282:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 1164              		.loc 1 282 11 view .LVU329
 1165 001c FFF7FEFF 		bl	tos_mutex_pend
 1166              	.LVL130:
 283:..//kernel/core/tos_rwlock.c ****         return err;
 1167              		.loc 1 283 5 is_stmt 1 view .LVU330
 283:..//kernel/core/tos_rwlock.c ****         return err;
 1168              		.loc 1 283 8 is_stmt 0 view .LVU331
 1169 0020 0546     		mov	r5, r0
 1170 0022 0028     		cmp	r0, #0
 1171 0024 F6D1     		bne	.L81
 287:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_NOT_WRITTING;
 1172              		.loc 1 287 5 is_stmt 1 view .LVU332
 287:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_NOT_WRITTING;
 1173              		.loc 1 287 16 is_stmt 0 view .LVU333
 1174 0026 A36B     		ldr	r3, [r4, #56]
 287:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_NOT_WRITTING;
 1175              		.loc 1 287 8 view .LVU334
 1176 0028 2BB9     		cbnz	r3, .L88
 288:..//kernel/core/tos_rwlock.c ****     } else {
 1177              		.loc 1 288 13 view .LVU335
 1178 002a 40F24465 		movw	r5, #1604
 1179              	.LVL131:
 1180              	.L82:
 294:..//kernel/core/tos_rwlock.c ****     return err;
 1181              		.loc 1 294 5 is_stmt 1 view .LVU336
 1182 002e 3046     		mov	r0, r6
 1183 0030 FFF7FEFF 		bl	tos_mutex_post
 1184              	.LVL132:
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 33


 295:..//kernel/core/tos_rwlock.c **** }
 1185              		.loc 1 295 5 view .LVU337
 295:..//kernel/core/tos_rwlock.c **** }
 1186              		.loc 1 295 12 is_stmt 0 view .LVU338
 1187 0034 EEE7     		b	.L81
 1188              	.LVL133:
 1189              	.L88:
 290:..//kernel/core/tos_rwlock.c ****         err = tos_sem_post_all(&rwlock->signal);
 1190              		.loc 1 290 9 is_stmt 1 view .LVU339
 290:..//kernel/core/tos_rwlock.c ****         err = tos_sem_post_all(&rwlock->signal);
 1191              		.loc 1 290 29 is_stmt 0 view .LVU340
 1192 0036 0023     		movs	r3, #0
 1193 0038 A363     		str	r3, [r4, #56]
 291:..//kernel/core/tos_rwlock.c ****     }
 1194              		.loc 1 291 9 is_stmt 1 view .LVU341
 291:..//kernel/core/tos_rwlock.c ****     }
 1195              		.loc 1 291 15 is_stmt 0 view .LVU342
 1196 003a 04F12400 		add	r0, r4, #36
 1197              	.LVL134:
 291:..//kernel/core/tos_rwlock.c ****     }
 1198              		.loc 1 291 15 view .LVU343
 1199 003e FFF7FEFF 		bl	tos_sem_post_all
 1200              	.LVL135:
 1201 0042 0546     		mov	r5, r0
 1202              	.LVL136:
 291:..//kernel/core/tos_rwlock.c ****     }
 1203              		.loc 1 291 15 view .LVU344
 1204 0044 F3E7     		b	.L82
 1205              	.LVL137:
 1206              	.L83:
 279:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 1207              		.loc 1 279 5 view .LVU345
 1208 0046 40F24C45 		movw	r5, #1100
 1209 004a E3E7     		b	.L81
 1210              		.cfi_endproc
 1211              	.LFE119:
 1213              		.section	.text.tos_rwlock_post,"ax",%progbits
 1214              		.align	1
 1215              		.global	tos_rwlock_post
 1216              		.syntax unified
 1217              		.thumb
 1218              		.thumb_func
 1219              		.fpu softvfp
 1221              	tos_rwlock_post:
 1222              	.LVL138:
 1223              	.LFB120:
 297:..//kernel/core/tos_rwlock.c **** 
 298:..//kernel/core/tos_rwlock.c **** __API__ k_err_t tos_rwlock_post(k_rwlock_t *rwlock)
 299:..//kernel/core/tos_rwlock.c **** {
 1224              		.loc 1 299 1 is_stmt 1 view -0
 1225              		.cfi_startproc
 1226              		@ args = 0, pretend = 0, frame = 0
 1227              		@ frame_needed = 0, uses_anonymous_args = 0
 1228              		.loc 1 299 1 is_stmt 0 view .LVU347
 1229 0000 70B5     		push	{r4, r5, r6, lr}
 1230              	.LCFI16:
 1231              		.cfi_def_cfa_offset 16
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 34


 1232              		.cfi_offset 4, -16
 1233              		.cfi_offset 5, -12
 1234              		.cfi_offset 6, -8
 1235              		.cfi_offset 14, -4
 300:..//kernel/core/tos_rwlock.c ****     k_err_t err;
 1236              		.loc 1 300 5 is_stmt 1 view .LVU348
 301:..//kernel/core/tos_rwlock.c **** 
 302:..//kernel/core/tos_rwlock.c ****     TOS_PTR_SANITY_CHECK(rwlock);
 1237              		.loc 1 302 5 view .LVU349
 1238              		.loc 1 302 5 view .LVU350
 1239 0002 68B3     		cbz	r0, .L93
 1240 0004 0446     		mov	r4, r0
 303:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 1241              		.loc 1 303 5 view .LVU351
 1242              		.loc 1 303 5 view .LVU352
 1243              	.LVL139:
 1244              	.LBB40:
 1245              	.LBI40:
 182:..//kernel/core/include/tos_sys.h **** {
 1246              		.loc 2 182 31 view .LVU353
 1247              	.LBB41:
 184:..//kernel/core/include/tos_sys.h **** }
 1248              		.loc 2 184 5 view .LVU354
 184:..//kernel/core/include/tos_sys.h **** }
 1249              		.loc 2 184 19 is_stmt 0 view .LVU355
 1250 0006 4188     		ldrh	r1, [r0, #2]
 1251              	.LVL140:
 184:..//kernel/core/include/tos_sys.h **** }
 1252              		.loc 2 184 19 view .LVU356
 1253              	.LBE41:
 1254              	.LBE40:
 1255              		.loc 1 303 5 view .LVU357
 1256 0008 49F6EE32 		movw	r2, #39918
 1257 000c 9142     		cmp	r1, r2
 1258 000e 03D0     		beq	.L97
 1259 0010 40F24D45 		movw	r5, #1101
 1260              	.LVL141:
 1261              	.L90:
 304:..//kernel/core/tos_rwlock.c **** 
 305:..//kernel/core/tos_rwlock.c ****     err = tos_mutex_pend(&rwlock->lock);
 306:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 307:..//kernel/core/tos_rwlock.c ****         return err;
 308:..//kernel/core/tos_rwlock.c ****     }
 309:..//kernel/core/tos_rwlock.c **** 
 310:..//kernel/core/tos_rwlock.c ****     if (rwlock->n_readers > 0u) {
 311:..//kernel/core/tos_rwlock.c ****         --rwlock->n_readers;
 312:..//kernel/core/tos_rwlock.c ****         if (rwlock->n_readers == 0u) {
 313:..//kernel/core/tos_rwlock.c ****             err = tos_sem_post_all(&rwlock->signal);
 314:..//kernel/core/tos_rwlock.c ****         }
 315:..//kernel/core/tos_rwlock.c ****     } else if (rwlock->is_writting) {
 316:..//kernel/core/tos_rwlock.c ****         rwlock->is_writting = K_FALSE;
 317:..//kernel/core/tos_rwlock.c ****         err = tos_sem_post_all(&rwlock->signal);
 318:..//kernel/core/tos_rwlock.c ****     } else {
 319:..//kernel/core/tos_rwlock.c ****         err = K_ERR_RWLOCK_NOT_TAKEN;
 320:..//kernel/core/tos_rwlock.c ****     }
 321:..//kernel/core/tos_rwlock.c **** 
 322:..//kernel/core/tos_rwlock.c ****     tos_mutex_post(&rwlock->lock);
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 35


 323:..//kernel/core/tos_rwlock.c ****     return err;
 324:..//kernel/core/tos_rwlock.c **** }
 1262              		.loc 1 324 1 view .LVU358
 1263 0014 2846     		mov	r0, r5
 1264 0016 70BD     		pop	{r4, r5, r6, pc}
 1265              	.LVL142:
 1266              	.L97:
 305:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 1267              		.loc 1 305 5 is_stmt 1 view .LVU359
 305:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 1268              		.loc 1 305 11 is_stmt 0 view .LVU360
 1269 0018 061D     		adds	r6, r0, #4
 1270 001a 3046     		mov	r0, r6
 1271              	.LVL143:
 305:..//kernel/core/tos_rwlock.c ****     if (err != K_ERR_NONE) {
 1272              		.loc 1 305 11 view .LVU361
 1273 001c FFF7FEFF 		bl	tos_mutex_pend
 1274              	.LVL144:
 306:..//kernel/core/tos_rwlock.c ****         return err;
 1275              		.loc 1 306 5 is_stmt 1 view .LVU362
 306:..//kernel/core/tos_rwlock.c ****         return err;
 1276              		.loc 1 306 8 is_stmt 0 view .LVU363
 1277 0020 0546     		mov	r5, r0
 1278 0022 0028     		cmp	r0, #0
 1279 0024 F6D1     		bne	.L90
 310:..//kernel/core/tos_rwlock.c ****         --rwlock->n_readers;
 1280              		.loc 1 310 5 is_stmt 1 view .LVU364
 310:..//kernel/core/tos_rwlock.c ****         --rwlock->n_readers;
 1281              		.loc 1 310 15 is_stmt 0 view .LVU365
 1282 0026 A38E     		ldrh	r3, [r4, #52]
 310:..//kernel/core/tos_rwlock.c ****         --rwlock->n_readers;
 1283              		.loc 1 310 8 view .LVU366
 1284 0028 6BB1     		cbz	r3, .L91
 311:..//kernel/core/tos_rwlock.c ****         if (rwlock->n_readers == 0u) {
 1285              		.loc 1 311 9 is_stmt 1 view .LVU367
 1286 002a 013B     		subs	r3, r3, #1
 1287 002c 9BB2     		uxth	r3, r3
 1288 002e A386     		strh	r3, [r4, #52]	@ movhi
 312:..//kernel/core/tos_rwlock.c ****             err = tos_sem_post_all(&rwlock->signal);
 1289              		.loc 1 312 9 view .LVU368
 312:..//kernel/core/tos_rwlock.c ****             err = tos_sem_post_all(&rwlock->signal);
 1290              		.loc 1 312 12 is_stmt 0 view .LVU369
 1291 0030 1BB1     		cbz	r3, .L98
 1292              	.LVL145:
 1293              	.L92:
 322:..//kernel/core/tos_rwlock.c ****     return err;
 1294              		.loc 1 322 5 is_stmt 1 view .LVU370
 1295 0032 3046     		mov	r0, r6
 1296 0034 FFF7FEFF 		bl	tos_mutex_post
 1297              	.LVL146:
 323:..//kernel/core/tos_rwlock.c **** }
 1298              		.loc 1 323 5 view .LVU371
 323:..//kernel/core/tos_rwlock.c **** }
 1299              		.loc 1 323 12 is_stmt 0 view .LVU372
 1300 0038 ECE7     		b	.L90
 1301              	.LVL147:
 1302              	.L98:
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 36


 313:..//kernel/core/tos_rwlock.c ****         }
 1303              		.loc 1 313 13 is_stmt 1 view .LVU373
 313:..//kernel/core/tos_rwlock.c ****         }
 1304              		.loc 1 313 19 is_stmt 0 view .LVU374
 1305 003a 04F12400 		add	r0, r4, #36
 1306              	.LVL148:
 313:..//kernel/core/tos_rwlock.c ****         }
 1307              		.loc 1 313 19 view .LVU375
 1308 003e FFF7FEFF 		bl	tos_sem_post_all
 1309              	.LVL149:
 1310 0042 0546     		mov	r5, r0
 1311              	.LVL150:
 313:..//kernel/core/tos_rwlock.c ****         }
 1312              		.loc 1 313 19 view .LVU376
 1313 0044 F5E7     		b	.L92
 1314              	.LVL151:
 1315              	.L91:
 315:..//kernel/core/tos_rwlock.c ****         rwlock->is_writting = K_FALSE;
 1316              		.loc 1 315 12 is_stmt 1 view .LVU377
 315:..//kernel/core/tos_rwlock.c ****         rwlock->is_writting = K_FALSE;
 1317              		.loc 1 315 22 is_stmt 0 view .LVU378
 1318 0046 A36B     		ldr	r3, [r4, #56]
 315:..//kernel/core/tos_rwlock.c ****         rwlock->is_writting = K_FALSE;
 1319              		.loc 1 315 15 view .LVU379
 1320 0048 13B9     		cbnz	r3, .L99
 319:..//kernel/core/tos_rwlock.c ****     }
 1321              		.loc 1 319 13 view .LVU380
 1322 004a 40F24565 		movw	r5, #1605
 1323 004e F0E7     		b	.L92
 1324              	.L99:
 316:..//kernel/core/tos_rwlock.c ****         err = tos_sem_post_all(&rwlock->signal);
 1325              		.loc 1 316 9 is_stmt 1 view .LVU381
 316:..//kernel/core/tos_rwlock.c ****         err = tos_sem_post_all(&rwlock->signal);
 1326              		.loc 1 316 29 is_stmt 0 view .LVU382
 1327 0050 0023     		movs	r3, #0
 1328 0052 A363     		str	r3, [r4, #56]
 317:..//kernel/core/tos_rwlock.c ****     } else {
 1329              		.loc 1 317 9 is_stmt 1 view .LVU383
 317:..//kernel/core/tos_rwlock.c ****     } else {
 1330              		.loc 1 317 15 is_stmt 0 view .LVU384
 1331 0054 04F12400 		add	r0, r4, #36
 1332              	.LVL152:
 317:..//kernel/core/tos_rwlock.c ****     } else {
 1333              		.loc 1 317 15 view .LVU385
 1334 0058 FFF7FEFF 		bl	tos_sem_post_all
 1335              	.LVL153:
 1336 005c 0546     		mov	r5, r0
 1337              	.LVL154:
 317:..//kernel/core/tos_rwlock.c ****     } else {
 1338              		.loc 1 317 15 view .LVU386
 1339 005e E8E7     		b	.L92
 1340              	.LVL155:
 1341              	.L93:
 302:..//kernel/core/tos_rwlock.c ****     TOS_OBJ_VERIFY(rwlock, KNL_OBJ_TYPE_RWLOCK);
 1342              		.loc 1 302 5 view .LVU387
 1343 0060 40F24C45 		movw	r5, #1100
 1344 0064 D6E7     		b	.L90
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 37


 1345              		.cfi_endproc
 1346              	.LFE120:
 1348              		.text
 1349              	.Letext0:
 1350              		.file 3 "..//kernel/core/include/tos_kerr.h"
 1351              		.file 4 "d:\\arm_gcc\\8 2019-q3-update\\arm-none-eabi\\include\\machine\\_default_types.h"
 1352              		.file 5 "d:\\arm_gcc\\8 2019-q3-update\\arm-none-eabi\\include\\sys\\_stdint.h"
 1353              		.file 6 "Drivers/CMSIS/Include/core_cm3.h"
 1354              		.file 7 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/system_stm32f1xx.h"
 1355              		.file 8 "d:\\arm_gcc\\8 2019-q3-update\\lib\\gcc\\arm-none-eabi\\8.3.1\\include\\stddef.h"
 1356              		.file 9 "d:\\arm_gcc\\8 2019-q3-update\\arm-none-eabi\\include\\sys\\_types.h"
 1357              		.file 10 "d:\\arm_gcc\\8 2019-q3-update\\arm-none-eabi\\include\\sys\\reent.h"
 1358              		.file 11 "d:\\arm_gcc\\8 2019-q3-update\\arm-none-eabi\\include\\sys\\lock.h"
 1359              		.file 12 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal.h"
 1360              		.file 13 "..//kernel/core/include/tos_ktypes.h"
 1361              		.file 14 "..//kernel/core/include/tos_task.h"
 1362              		.file 15 "d:\\arm_gcc\\8 2019-q3-update\\arm-none-eabi\\include\\stdlib.h"
 1363              		.file 16 "..//kernel/core/include/tos_list.h"
 1364              		.file 17 "..//kernel/core/include/tos_pend.h"
 1365              		.file 18 "..//kernel/core/include/tos_mutex.h"
 1366              		.file 19 "..//kernel/core/include/tos_sem.h"
 1367              		.file 20 "..//kernel/core/include/tos_rwlock.h"
 1368              		.file 21 "..//kernel/core/include/tos_timer.h"
 1369              		.file 22 "..//kernel/core/include/tos_stopwatch.h"
 1370              		.file 23 "..//kernel/core/include/tos_mmheap.h"
 1371              		.file 24 "..//kernel/core/include/tos_sched.h"
 1372              		.file 25 "..//kernel/core/include/tos_global.h"
ARM GAS  C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s 			page 38


DEFINED SYMBOLS
                            *ABS*:00000000 tos_rwlock.c
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:16     .text.tos_rwlock_create:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:24     .text.tos_rwlock_create:00000000 tos_rwlock_create
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:123    .text.tos_rwlock_destroy:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:130    .text.tos_rwlock_destroy:00000000 tos_rwlock_destroy
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:231    .text.tos_rwlock_rpend_timed:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:238    .text.tos_rwlock_rpend_timed:00000000 tos_rwlock_rpend_timed
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:468    .text.tos_rwlock_rpend:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:475    .text.tos_rwlock_rpend:00000000 tos_rwlock_rpend
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:500    .text.tos_rwlock_rpend_try:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:507    .text.tos_rwlock_rpend_try:00000000 tos_rwlock_rpend_try
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:623    .text.tos_rwlock_wpend_timed:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:630    .text.tos_rwlock_wpend_timed:00000000 tos_rwlock_wpend_timed
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:854    .text.tos_rwlock_wpend:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:861    .text.tos_rwlock_wpend:00000000 tos_rwlock_wpend
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:886    .text.tos_rwlock_wpend_try:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:893    .text.tos_rwlock_wpend_try:00000000 tos_rwlock_wpend_try
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:995    .text.tos_rwlock_rpost:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:1002   .text.tos_rwlock_rpost:00000000 tos_rwlock_rpost
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:1106   .text.tos_rwlock_wpost:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:1113   .text.tos_rwlock_wpost:00000000 tos_rwlock_wpost
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:1214   .text.tos_rwlock_post:00000000 $t
C:\Users\tianx\AppData\Local\Temp\ccVh6BBp.s:1221   .text.tos_rwlock_post:00000000 tos_rwlock_post

UNDEFINED SYMBOLS
tos_sem_create
tos_mutex_create
tos_sem_destroy
tos_mutex_destroy
tos_mutex_pend_timed
tos_sem_pend
tos_stopwatch_remain
tos_mutex_post
tos_stopwatch_create
tos_stopwatch_countdown
tos_sem_post_all
tos_mutex_pend
